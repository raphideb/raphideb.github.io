<!DOCTYPE html>
<html
  lang="en"
  class="color-toggle-hidden"
  
>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8" />
<meta name="referrer" content="no-referrer" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="color-scheme" content="light dark" />
<meta name="generator" content="Hugo 0.147.9">


  <meta name="description" content=" Purpose of this script The cumulative statistics system (CSS) in PostgreSQL and pg_stat_statements in particular lack any timing information, all values are cumulative and the only way to figure out the difference between query executions is to reset the stats every time or work with averages.
With the pgstat_snap extension, you can create timestamped snapshots of pg_stat_statements and pg_stat_activity when needed. It also provides views that show the difference between every snapshot for every query and database." />

    <title>pgstat_snap | raphi&#39;s corner</title>

    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
<link
  rel="icon"
  type="image/png"
  sizes="32x32"
  href="/favicon/favicon-32x32.png"
/>
<link
  rel="icon"
  type="image/png"
  sizes="16x16"
  href="/favicon/favicon-16x16.png"
/>

    

    
  <meta
    property="og:title"
    content="pgstat_snap"
  />
  <meta property="og:site_name" content="raphi's corner" />
  <meta property="og:description" content=" Purpose of this script The cumulative statistics system (CSS) in PostgreSQL and pg_stat_statements in particular lack any timing information, all values are cumulative and the only way to figure out the difference between query executions is to reset the stats every time or work with averages.
With the pgstat_snap extension, you can create timestamped snapshots of pg_stat_statements and pg_stat_activity when needed. It also provides views that show the difference between every snapshot for every query and database." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/postgres/pgstat_snap/" />

<meta property="article:section" content="Postgres" />
    <meta
      property="article:modified_time"
      content="2025-07-08T23:30:37+02:00"
    />


  <meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="pgstat_snap" />
  <meta name="twitter:description" content=" Purpose of this script The cumulative statistics system (CSS) in PostgreSQL and pg_stat_statements in particular lack any timing information, all values are cumulative and the only way to figure out the difference between query executions is to reset the stats every time or work with averages.
With the pgstat_snap extension, you can create timestamped snapshots of pg_stat_statements and pg_stat_activity when needed. It also provides views that show the difference between every snapshot for every query and database." />


  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "TechArticle",
      "articleSection": "Postgres",
      "name": "pgstat_snap",
      "url" : "http://localhost:1313/postgres/pgstat_snap/",
      "headline": "pgstat_snap",
      "description": " Purpose of this script The cumulative statistics system (CSS) in PostgreSQL and pg_stat_statements in particular lack any timing information, all values are cumulative and the only way to figure out the difference between query executions is to reset the stats every time or work with averages.\nWith the pgstat_snap extension, you can create timestamped snapshots of pg_stat_statements and pg_stat_activity when needed. It also provides views that show the difference between every snapshot for every query and database.",
      "wordCount" : "1622",
      "inLanguage": "en",
      "isFamilyFriendly": "true",
      "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "http://localhost:1313/postgres/pgstat_snap/"
      },
      "copyrightHolder" : "raphi\u0027s corner",
      "copyrightYear" : "0001",
      "dateCreated": "0001-01-01T00:00:00.00Z",
      "datePublished": "0001-01-01T00:00:00.00Z",
      "dateModified": "2025-07-08T23:30:37.00Z",
      "publisher":{
          "@type":"Organization",
          "name": "raphi's corner",
          "url": "http://localhost:1313/",
          "logo": {
              "@type": "ImageObject",
              "url": "http://localhost:1313/brand.svg",
              "width":"32",
              "height":"32"
          }
      }
  }
  </script>


    
  <script src="/js/colortheme-05deda6f.bundle.min.js"></script>
<script src="/js/main-c5dd8165.bundle.min.js"></script>

<link
  rel="preload"
  as="font"
  href="/fonts/Metropolis.woff2"
  type="font/woff2"
  crossorigin="anonymous"
/>
<link
  rel="preload"
  as="font"
  href="/fonts/LiberationSans.woff2"
  type="font/woff2"
  crossorigin="anonymous"
/>

<link
  rel="preload"
  href="/main-b53472e8.min.css"
  as="style"
/>
<link
  rel="stylesheet"
  href="/main-b53472e8.min.css"
  media="all"
/>

<link
  rel="preload"
  href="/mobile-7885c8a8.min.css"
  as="style"
/>
<link
  rel="stylesheet"
  href="/mobile-7885c8a8.min.css"
  media="screen and (max-width: 45rem)"
/>

<link
  rel="preload"
  href="/print-72068949.min.css"
  as="style"
/>
<link
  rel="stylesheet"
  href="/print-72068949.min.css"
  media="print"
/>

<link
  rel="preload"
  href="/custom.css"
  as="style"
/>
<link
  rel="stylesheet"
  href="/custom.css"
  media="all"
/>
  <link href="http://localhost:1313/postgres/pgstat_snap/" rel="canonical" type="text/html" />

<!-- Made with Geekdoc theme https://github.com/thegeeklab/hugo-geekdoc -->

    <link rel="stylesheet" type="text/css" href="/css/custom.css" />

  </head>

  <body itemscope itemtype="https://schema.org/WebPage">
    <div class="w-full flex justify-center">
      <a href="#main-content" id="gdoc-to-main" class="gdoc-markdown__link">Skip to main content</a>
    </div>

    
  <!-- geekdoc include: /sprites/geekdoc.svg -->
  <svg class="svg-sprite" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_arrow_back" xmlns="http://www.w3.org/2000/svg"><path d="M24 10.526v2.947H5.755l8.351 8.421-2.105 2.105-12-12 12-12 2.105 2.105-8.351 8.421H24z"/></svg><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_arrow_left_alt" xmlns="http://www.w3.org/2000/svg"><path d="M5.965 10.526V6.035L0 12l5.965 5.965v-4.491H24v-2.947H5.965z"/></svg><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_arrow_right_alt" xmlns="http://www.w3.org/2000/svg"><path d="M18.035 10.526V6.035L24 12l-5.965 5.965v-4.491H0v-2.947h18.035z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_bitbucket" xmlns="http://www.w3.org/2000/svg"><path d="M15.905 13.355c.189 1.444-1.564 2.578-2.784 1.839-1.375-.602-1.375-2.784-.034-3.403 1.151-.705 2.818.223 2.818 1.564zm1.907-.361c-.309-2.44-3.076-4.056-5.328-3.042-1.426.636-2.389 2.148-2.32 3.747.086 2.097 2.08 3.815 4.176 3.626s3.729-2.234 3.472-4.331zm4.108-9.315c-.756-.997-2.045-1.169-3.179-1.358-3.214-.516-6.513-.533-9.727.034-1.066.172-2.269.361-2.939 1.323 1.1 1.031 2.664 1.186 4.073 1.358 2.544.327 5.156.344 7.699.017 1.426-.172 3.008-.309 4.073-1.375zm.979 17.788c-.481 1.684-.206 3.953-1.994 4.932-3.076 1.701-6.806 1.89-10.191 1.289-1.787-.327-3.884-.894-4.864-2.578-.43-1.65-.705-3.334-.98-5.018l.103-.275.309-.155c5.121 3.386 12.288 3.386 17.427 0 .808.241.206 1.22.189 1.805zM26.01 4.951c-.584 3.764-1.255 7.51-1.908 11.257-.189 1.1-1.255 1.719-2.148 2.183-3.214 1.615-6.96 1.89-10.483 1.512-2.389-.258-4.829-.894-6.771-2.389-.911-.705-.911-1.908-1.083-2.922-.602-3.523-1.289-7.046-1.719-10.604.206-1.547 1.942-2.217 3.231-2.698C6.848.654 8.686.362 10.508.19c3.884-.378 7.854-.241 11.618.859 1.341.395 2.784.945 3.695 2.097.412.533.275 1.203.189 1.805z"/></svg><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_bookmark" xmlns="http://www.w3.org/2000/svg"><path d="M15.268 4.392q.868 0 1.532.638t.664 1.506v17.463l-7.659-3.268-7.608 3.268V6.536q0-.868.664-1.506t1.532-.638h10.876zm4.34 14.144V4.392q0-.868-.638-1.532t-1.506-.664H6.537q0-.868.664-1.532T8.733 0h10.876q.868 0 1.532.664t.664 1.532v17.412z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_brightness_auto" xmlns="http://www.w3.org/2000/svg"><path d="M16.846 18.938h2.382L15.22 7.785h-2.44L8.772 18.938h2.382l.871-2.44h3.95zm7.087-9.062L27.999 14l-4.066 4.124v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809zm-11.385 4.937L14 10.282l1.452 4.531h-2.904z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_brightness_dark" xmlns="http://www.w3.org/2000/svg"><path d="M14 21.435q3.079 0 5.257-2.178T21.435 14t-2.178-5.257T14 6.565q-1.51 0-3.079.697 1.917.871 3.108 2.701T15.22 14t-1.191 4.037-3.108 2.701q1.568.697 3.079.697zm9.933-11.559L27.999 14l-4.066 4.124v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_brightness_light" xmlns="http://www.w3.org/2000/svg"><path d="M14 21.435q3.079 0 5.257-2.178T21.435 14t-2.178-5.257T14 6.565 8.743 8.743 6.565 14t2.178 5.257T14 21.435zm9.933-3.311v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809L27.999 14z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_check" xmlns="http://www.w3.org/2000/svg"><path d="M8.885 20.197 25.759 3.323l2.24 2.24L8.885 24.677 0 15.792l2.24-2.24z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_check_circle_outline" xmlns="http://www.w3.org/2000/svg"><path d="M14 25.239q4.601 0 7.92-3.319T25.239 14 21.92 6.08 14 2.761 6.08 6.08 2.761 14t3.319 7.92T14 25.239zM14 0q5.784 0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0zm6.441 7.822 1.972 1.972-11.239 11.239L4.207 14l1.972-1.972 4.995 4.995z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_cloud_off" xmlns="http://www.w3.org/2000/svg"><path d="M9.023 10.5H7q-1.914 0-3.281 1.395t-1.367 3.309 1.367 3.281T7 19.852h11.375zM3.5 4.976l1.477-1.477L24.5 23.022l-1.477 1.477-2.352-2.297H6.999q-2.898 0-4.949-2.051t-2.051-4.949q0-2.844 1.969-4.867t4.758-2.133zm19.086 5.578q2.242.164 3.828 1.832T28 16.351q0 3.008-2.461 4.758l-1.695-1.695q1.805-.984 1.805-3.063 0-1.422-1.039-2.461t-2.461-1.039h-1.75v-.602q0-2.68-1.859-4.539t-4.539-1.859q-1.531 0-2.953.711l-1.75-1.695Q11.431 3.5 14.001 3.5q2.953 0 5.496 2.078t3.09 4.977z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_code" xmlns="http://www.w3.org/2000/svg"><path d="M9.917 24.5a1.75 1.75 0 1 0-3.501.001 1.75 1.75 0 0 0 3.501-.001zm0-21a1.75 1.75 0 1 0-3.501.001A1.75 1.75 0 0 0 9.917 3.5zm11.666 2.333a1.75 1.75 0 1 0-3.501.001 1.75 1.75 0 0 0 3.501-.001zm1.75 0a3.502 3.502 0 0 1-1.75 3.026c-.055 6.581-4.721 8.039-7.82 9.023-2.898.911-3.846 1.349-3.846 3.117v.474a3.502 3.502 0 0 1 1.75 3.026c0 1.932-1.568 3.5-3.5 3.5s-3.5-1.568-3.5-3.5c0-1.294.711-2.424 1.75-3.026V6.526A3.502 3.502 0 0 1 4.667 3.5c0-1.932 1.568-3.5 3.5-3.5s3.5 1.568 3.5 3.5a3.502 3.502 0 0 1-1.75 3.026v9.06c.93-.456 1.914-.766 2.807-1.039 3.391-1.075 5.323-1.878 5.359-5.687a3.502 3.502 0 0 1-1.75-3.026c0-1.932 1.568-3.5 3.5-3.5s3.5 1.568 3.5 3.5z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_copy" xmlns="http://www.w3.org/2000/svg"><path d="M23.502 25.438V7.626H9.562v17.812h13.94zm0-20.315q1.013 0 1.787.745t.774 1.757v17.812q0 1.013-.774 1.787t-1.787.774H9.562q-1.013 0-1.787-.774t-.774-1.787V7.625q0-1.013.774-1.757t1.787-.745h13.94zM19.689 0v2.562H4.438v17.812H1.936V2.562q0-1.013.745-1.787T4.438.001h15.251z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_dangerous" xmlns="http://www.w3.org/2000/svg"><path d="M21.802 19.833 15.969 14l5.833-5.833-1.969-1.969L14 12.031 8.167 6.198 6.198 8.167 12.031 14l-5.833 5.833 1.969 1.969L14 15.969l5.833 5.833zM19.833 0 28 8.167v11.666L19.833 28H8.167L0 19.833V8.167L8.167 0h11.666z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_date" xmlns="http://www.w3.org/2000/svg"><path d="M27.192 28.844V11.192H4.808v17.652h22.384zm0-25.689q1.277 0 2.253.976t.976 2.253v22.459q0 1.277-.976 2.216t-2.253.939H4.808q-1.352 0-2.291-.901t-.939-2.253V6.385q0-1.277.939-2.253t2.291-.976h1.577V.001h3.23v3.155h12.769V.001h3.23v3.155h1.577zm-3.155 11.267v3.155h-3.23v-3.155h3.23zm-6.46 0v3.155h-3.155v-3.155h3.155zm-6.384 0v3.155h-3.23v-3.155h3.23z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_download" xmlns="http://www.w3.org/2000/svg"><path d="M2.866 28.209h26.269v3.79H2.866v-3.79zm26.268-16.925L16 24.418 2.866 11.284h7.493V.001h11.283v11.283h7.493z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_email" xmlns="http://www.w3.org/2000/svg"><path d="M28.845 9.615v-3.23L16 14.422 3.155 6.385v3.23L16 17.577zm0-6.46q1.277 0 2.216.977T32 6.385v19.23q0 1.277-.939 2.253t-2.216.977H3.155q-1.277 0-2.216-.977T0 25.615V6.385q0-1.277.939-2.253t2.216-.977h25.69z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_error_outline" xmlns="http://www.w3.org/2000/svg"><path d="M14 25.239q4.601 0 7.92-3.319T25.239 14 21.92 6.08 14 2.761 6.08 6.08 2.761 14t3.319 7.92T14 25.239zM14 0q5.784 0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0zm-1.38 6.967h2.761v8.413H12.62V6.967zm0 11.239h2.761v2.826H12.62v-2.826z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_fire" xmlns="http://www.w3.org/2000/svg"><path d="M17.689 21.998q-.32.32-.8.576t-.864.384q-1.152.384-2.272.032t-1.888-.992q-.128-.128-.096-.256t.16-.192q1.216-.384 1.92-1.216t.96-1.792q.192-.896-.064-1.728t-.384-1.728q-.128-.704-.096-1.376t.288-1.312q0-.128.128-.128t.192.064q.384.832.992 1.472t1.28 1.216 1.216 1.248.672 1.568q.064.384.064.704.064.96-.32 1.92t-1.088 1.536zm3.84-10.944q-.768-.704-1.6-1.28t-1.6-1.344q-1.536-1.536-2.016-3.584t.16-4.16q.128-.32-.096-.544t-.544-.096q-.768.32-1.44.768t-1.312.896q-1.984 1.664-3.136 3.936T8.633 10.51t.8 5.088q0 .128.032.256t.032.256q0 .576-.512.832t-1.024-.192q-.128-.192-.192-.32-1.024-1.28-1.376-2.912t-.096-3.232q.064-.384-.288-.576t-.608.128q-1.28 1.664-1.856 3.68t-.448 4.064q0 .576.096 1.184t.288 1.184q.448 1.536 1.216 2.816 1.216 2.048 3.264 3.424t4.416 1.696q2.496.32 5.024-.256t4.448-2.304q1.408-1.344 2.208-3.104t.864-3.68-.704-3.712q-.064-.128-.096-.224t-.096-.224q-.576-1.088-1.28-1.984-.256-.384-.544-.704t-.672-.64z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_git" xmlns="http://www.w3.org/2000/svg"><path d="M27.472 12.753 15.247.529a1.803 1.803 0 0 0-2.55 0l-2.84 2.84 2.137 2.137a2.625 2.625 0 0 1 3.501 3.501l3.499 3.499a2.625 2.625 0 1 1-1.237 1.237l-3.499-3.499c-.083.04-.169.075-.257.106v7.3a2.626 2.626 0 1 1-1.75 0v-7.3a2.626 2.626 0 0 1-1.494-3.607L8.62 4.606l-8.09 8.09a1.805 1.805 0 0 0 0 2.551l12.225 12.224a1.803 1.803 0 0 0 2.55 0l12.168-12.168a1.805 1.805 0 0 0 0-2.551z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_gitea" xmlns="http://www.w3.org/2000/svg"><path d="M5.581 7.229c-2.46-.005-5.755 1.559-5.573 5.48.284 6.125 6.56 6.693 9.068 6.743.275 1.149 3.227 5.112 5.412 5.32h9.573c5.741-.381 10.04-17.363 6.853-17.427-5.271.248-8.395.373-11.073.395v5.3l-.835-.369-.005-4.928c-3.075-.001-5.781-.144-10.919-.397-.643-.004-1.539-.113-2.501-.116zm.348 2.166h.293c.349 3.14.917 4.976 2.067 7.781-2.933-.347-5.429-1.199-5.888-4.38-.237-1.647.563-3.365 3.528-3.401zm11.409 3.087c.2.003.404.04.596.128l.999.431-.716 1.305h-.007a.996.996 0 0 0-.321.053l.006-.002c-.349.114-.593.406-.593.749 0 .097.019.189.055.275l-.002-.006a.767.767 0 0 0 .151.233l-.001-.001-1.235 2.248a.99.99 0 0 0-.302.052l.006-.002c-.349.114-.593.406-.593.749 0 .097.019.189.055.275l-.002-.006c.128.31.457.527.843.527a.987.987 0 0 0 .31-.049l-.006.002c.348-.114.592-.406.592-.749 0-.097-.02-.19-.056-.277l.002.006a.784.784 0 0 0-.211-.293l1.203-2.189a.999.999 0 0 0 .397-.041l-.006.002a.942.942 0 0 0 .285-.15l-.001.001c.464.195.844.353 1.117.488.411.203.556.337.6.487.044.147-.004.429-.236.925-.173.369-.46.893-.799 1.511h-.02a.991.991 0 0 0-.321.053l.006-.002c-.349.114-.593.406-.593.749 0 .097.019.189.055.275l-.002-.006c.128.31.457.527.843.527a.987.987 0 0 0 .31-.049l-.006.002c.348-.114.592-.406.592-.749a.703.703 0 0 0-.055-.275l.002.006a.802.802 0 0 0-.183-.27l.001.001c.335-.611.623-1.136.808-1.531.251-.536.381-.935.267-1.32s-.467-.636-.933-.867c-.307-.151-.689-.311-1.147-.503a.723.723 0 0 0-.052-.324l.002.006a.792.792 0 0 0-.194-.279l.704-1.284 3.899 1.684c.704.305.995 1.053.653 1.68l-2.68 4.907c-.343.625-1.184.884-1.888.58l-5.516-2.384c-.704-.304-.996-1.053-.653-1.68l2.68-4.905c.235-.431.707-.687 1.207-.707z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_github" xmlns="http://www.w3.org/2000/svg"><path d="M16 .394c8.833 0 15.999 7.166 15.999 15.999 0 7.062-4.583 13.062-10.937 15.187-.813.146-1.104-.354-1.104-.771 0-.521.021-2.25.021-4.396 0-1.5-.5-2.458-1.083-2.958 3.562-.396 7.312-1.75 7.312-7.896 0-1.75-.625-3.167-1.646-4.291.167-.417.708-2.042-.167-4.25-1.333-.417-4.396 1.646-4.396 1.646a15.032 15.032 0 0 0-8 0S8.937 6.602 7.603 7.018c-.875 2.208-.333 3.833-.167 4.25-1.021 1.125-1.646 2.542-1.646 4.291 0 6.125 3.729 7.5 7.291 7.896-.458.417-.875 1.125-1.021 2.146-.917.417-3.25 1.125-4.646-1.333-.875-1.521-2.458-1.646-2.458-1.646-1.562-.021-.104.979-.104.979 1.042.479 1.771 2.333 1.771 2.333.938 2.854 5.396 1.896 5.396 1.896 0 1.333.021 2.583.021 2.979 0 .417-.292.917-1.104.771C4.582 29.455-.001 23.455-.001 16.393-.001 7.56 7.165.394 15.998.394zM6.063 23.372c.042-.083-.021-.187-.146-.25-.125-.042-.229-.021-.271.042-.042.083.021.187.146.25.104.062.229.042.271-.042zm.646.709c.083-.062.062-.208-.042-.333-.104-.104-.25-.146-.333-.062-.083.062-.062.208.042.333.104.104.25.146.333.062zm.625.937c.104-.083.104-.25 0-.396-.083-.146-.25-.208-.354-.125-.104.062-.104.229 0 .375s.271.208.354.146zm.875.875c.083-.083.042-.271-.083-.396-.146-.146-.333-.167-.417-.062-.104.083-.062.271.083.396.146.146.333.167.417.062zm1.187.521c.042-.125-.083-.271-.271-.333-.167-.042-.354.021-.396.146s.083.271.271.312c.167.062.354 0 .396-.125zm1.313.104c0-.146-.167-.25-.354-.229-.187 0-.333.104-.333.229 0 .146.146.25.354.229.187 0 .333-.104.333-.229zm1.208-.208c-.021-.125-.187-.208-.375-.187-.187.042-.312.167-.292.312.021.125.187.208.375.167s.312-.167.292-.292z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_gitlab" xmlns="http://www.w3.org/2000/svg"><path d="M1.629 11.034 14 26.888.442 17.048a1.09 1.09 0 0 1-.39-1.203l1.578-4.811zm7.217 0h10.309l-5.154 15.854zM5.753 1.475l3.093 9.559H1.63l3.093-9.559a.548.548 0 0 1 1.031 0zm20.618 9.559 1.578 4.811c.141.437-.016.922-.39 1.203l-13.558 9.84 12.371-15.854zm0 0h-7.216l3.093-9.559a.548.548 0 0 1 1.031 0z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_heart" xmlns="http://www.w3.org/2000/svg"><path d="M16 29.714a1.11 1.11 0 0 1-.786-.321L4.072 18.643c-.143-.125-4.071-3.714-4.071-8 0-5.232 3.196-8.357 8.535-8.357 3.125 0 6.053 2.464 7.464 3.857 1.411-1.393 4.339-3.857 7.464-3.857 5.339 0 8.535 3.125 8.535 8.357 0 4.286-3.928 7.875-4.089 8.035L16.785 29.392c-.214.214-.5.321-.786.321z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_home" xmlns="http://www.w3.org/2000/svg"><path d="M24.003 15.695v8.336c0 .608-.504 1.111-1.111 1.111h-6.669v-6.669h-4.446v6.669H5.108a1.119 1.119 0 0 1-1.111-1.111v-8.336c0-.035.017-.069.017-.104L14 7.359l9.986 8.232a.224.224 0 0 1 .017.104zm3.873-1.198-1.077 1.285a.578.578 0 0 1-.365.191h-.052a.547.547 0 0 1-.365-.122L14 5.831 1.983 15.851a.594.594 0 0 1-.417.122.578.578 0 0 1-.365-.191L.124 14.497a.57.57 0 0 1 .069-.781L12.679 3.314c.729-.608 1.91-.608 2.64 0l4.237 3.543V3.471c0-.313.243-.556.556-.556h3.334c.313 0 .556.243.556.556v7.085l3.803 3.161c.226.191.26.556.069.781z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_info_outline" xmlns="http://www.w3.org/2000/svg"><path d="M12.62 9.793V6.967h2.761v2.826H12.62zM14 25.239q4.601 0 7.92-3.319T25.239 14 21.92 6.08 14 2.761 6.08 6.08 2.761 14t3.319 7.92T14 25.239zM14 0q5.784 0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0zm-1.38 21.033V12.62h2.761v8.413H12.62z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_keyboard_arrow_down" xmlns="http://www.w3.org/2000/svg"><path d="M3.281 5.36 14 16.079 24.719 5.36 28 8.641l-14 14-14-14z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_keyboard_arrow_left" xmlns="http://www.w3.org/2000/svg"><path d="M25.875 28.25 22.125 32 6.126 16.001 22.125.002l3.75 3.75-12.25 12.25z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_keyboard_arrow_right" xmlns="http://www.w3.org/2000/svg"><path d="M6.125 28.25 18.375 16 6.125 3.75 9.875 0l15.999 15.999L9.875 31.998z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_keyboard_arrow_up" xmlns="http://www.w3.org/2000/svg"><path d="M24.719 22.64 14 11.921 3.281 22.64 0 19.359l14-14 14 14z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_language" xmlns="http://www.w3.org/2000/svg"><path d="M20.112 16.826h4.732q.394-1.84.394-2.826t-.394-2.826h-4.732q.197 1.38.197 2.826t-.197 2.826zm-2.497 7.756q1.643-.526 3.418-2.005t2.695-2.991h-4.141q-.657 2.629-1.972 4.995zm-.329-7.756q.197-1.38.197-2.826t-.197-2.826h-6.573q-.197 1.38-.197 2.826t.197 2.826h6.573zM14 25.173q1.84-2.695 2.695-5.587h-5.39q.854 2.892 2.695 5.587zM8.413 8.413q.789-2.826 1.972-4.995-1.643.526-3.451 2.005T4.272 8.414h4.141zM4.272 19.587q.854 1.512 2.662 2.991t3.451 2.005q-1.315-2.366-1.972-4.995H4.272zm-1.117-2.761h4.732Q7.69 15.446 7.69 14t.197-2.826H3.155q-.394 1.84-.394 2.826t.394 2.826zM14 2.826q-1.84 2.695-2.695 5.587h5.39Q15.841 5.521 14 2.826zm9.727 5.587q-.92-1.512-2.695-2.991t-3.418-2.005q1.183 2.169 1.972 4.995h4.141zM14 0q5.784 0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_link" xmlns="http://www.w3.org/2000/svg"><path d="M24.037 7.963q3.305 0 5.634 2.366T32 16t-2.329 5.671-5.634 2.366h-6.46v-3.08h6.46q2.028 0 3.493-1.465t1.465-3.493-1.465-3.493-3.493-1.465h-6.46v-3.08h6.46zM9.615 17.578v-3.155h12.77v3.155H9.615zM3.005 16q0 2.028 1.465 3.493t3.493 1.465h6.46v3.08h-6.46q-3.305 0-5.634-2.366T0 16.001t2.329-5.671 5.634-2.366h6.46v3.08h-6.46q-2.028 0-3.493 1.465t-1.465 3.493z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_mastodon" xmlns="http://www.w3.org/2000/svg"><path d="M30.924 10.506c0-6.941-4.548-8.976-4.548-8.976C24.083.477 20.144.034 16.054.001h-.101C11.862.034 7.926.477 5.633 1.53c0 0-4.548 2.035-4.548 8.976 0 1.589-.031 3.491.02 5.505.165 6.79 1.245 13.479 7.522 15.14 2.893.765 5.379.927 7.38.816 3.629-.2 5.667-1.296 5.667-1.296l-.12-2.633s-2.593.817-5.505.719c-2.887-.099-5.932-.311-6.399-3.855a7.069 7.069 0 0 1-.064-.967v-.028.001s2.833.693 6.423.857c2.195.1 4.253-.129 6.344-.377 4.009-.479 7.5-2.949 7.939-5.207.689-3.553.633-8.676.633-8.676zm-5.366 8.945h-3.329v-8.159c0-1.72-.724-2.592-2.171-2.592-1.6 0-2.403 1.035-2.403 3.083v4.465h-3.311v-4.467c0-2.048-.803-3.083-2.403-3.083-1.447 0-2.171.873-2.171 2.592v8.159H6.441v-8.404c0-1.719.437-3.084 1.316-4.093.907-1.011 2.092-1.528 3.565-1.528 1.704 0 2.995.655 3.848 1.965l.828 1.391.829-1.391c.853-1.311 2.144-1.965 3.848-1.965 1.472 0 2.659.517 3.565 1.528.877 1.009 1.315 2.375 1.315 4.093z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_matrix" xmlns="http://www.w3.org/2000/svg"><path d="M.843.734v30.532H3.04v.733H0V0h3.04v.733zm9.391 9.68v1.543h.044a4.417 4.417 0 0 1 1.489-1.365c.577-.327 1.248-.487 2-.487.72 0 1.377.143 1.975.419.597.277 1.047.776 1.36 1.477.339-.499.8-.941 1.379-1.323.579-.383 1.267-.573 2.061-.573.604 0 1.163.075 1.68.223a3.34 3.34 0 0 1 1.324.707c.368.327.652.745.861 1.268.203.523.307 1.151.307 1.889v7.637h-3.132v-6.468c0-.381-.013-.745-.043-1.083a2.315 2.315 0 0 0-.246-.893l.006.013a1.484 1.484 0 0 0-.577-.593l-.007-.004c-.259-.147-.609-.221-1.047-.221-.443 0-.8.085-1.071.252-.267.166-.483.39-.635.656l-.005.009a2.558 2.558 0 0 0-.307.915l-.002.013a7.156 7.156 0 0 0-.08 1.044v6.359h-3.133v-6.4c0-.339-.005-.671-.024-1.003a2.772 2.772 0 0 0-.197-.936l.007.019a1.41 1.41 0 0 0-.548-.667l-.006-.003c-.259-.167-.635-.253-1.139-.253-.148 0-.345.032-.585.099-.24.068-.48.191-.707.376-.228.184-.425.449-.585.793-.16.345-.24.8-.24 1.36v6.621H7.279v-11.42zm20.923 20.852V.734H28.96V.001H32V32h-3.04v-.733z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_menu" xmlns="http://www.w3.org/2000/svg"><path d="M.001 5.334h31.998v3.583H.001V5.334zm0 12.416v-3.5h31.998v3.5H.001zm0 8.916v-3.583h31.998v3.583H.001z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_notification" xmlns="http://www.w3.org/2000/svg"><path d="m22.615 19.384 2.894 2.894v1.413H2.49v-1.413l2.894-2.894V12.25q0-3.365 1.716-5.856t4.745-3.231v-1.01q0-.875.606-1.514T13.999 0t1.548.639.606 1.514v1.01q3.029.74 4.745 3.231t1.716 5.856v7.134zM14 27.999q-1.211 0-2.053-.808t-.841-2.019h5.788q0 1.144-.875 1.986T14 27.999z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_path" xmlns="http://www.w3.org/2000/svg"><path d="M28 12.62h-9.793V8.414h-2.826v11.173h2.826v-4.206H28V26.62h-9.793v-4.206H12.62v-14H9.794v4.206H.001V1.381h9.793v4.206h8.413V1.381H28V12.62z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_person" xmlns="http://www.w3.org/2000/svg"><path d="M16 20.023q5.052 0 10.526 2.199t5.473 5.754v4.023H0v-4.023q0-3.555 5.473-5.754t10.526-2.199zM16 16q-3.275 0-5.614-2.339T8.047 8.047t2.339-5.661T16 0t5.614 2.386 2.339 5.661-2.339 5.614T16 16z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_search" xmlns="http://www.w3.org/2000/svg"><path d="M11.925 20.161q3.432 0 5.834-2.402t2.402-5.834-2.402-5.834-5.834-2.402-5.834 2.402-2.402 5.834 2.402 5.834 5.834 2.402zm10.981 0L32 29.255 29.255 32l-9.094-9.094v-1.458l-.515-.515q-3.26 2.831-7.721 2.831-4.976 0-8.45-3.432T.001 11.925t3.474-8.45 8.45-3.474 8.407 3.474 3.432 8.45q0 1.802-.858 4.075t-1.973 3.646l.515.515h1.458z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_shield" xmlns="http://www.w3.org/2000/svg"><path d="M22.167 15.166V3.5h-8.166v20.726c.93-.492 2.424-1.349 3.883-2.497 1.95-1.531 4.284-3.919 4.284-6.562zm3.499-13.999v14c0 7.674-10.737 12.523-11.192 12.724-.146.073-.31.109-.474.109s-.328-.036-.474-.109c-.456-.201-11.192-5.049-11.192-12.724v-14C2.334.529 2.863 0 3.501 0H24.5c.638 0 1.167.529 1.167 1.167z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_star" xmlns="http://www.w3.org/2000/svg"><path d="M14 22.052 5.324 27.31l2.3-9.859L0 10.813l10.056-.854L14 .692l3.944 9.267L28 10.813l-7.624 6.638 2.3 9.859z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_tag" xmlns="http://www.w3.org/2000/svg"><path d="M17.52 17.52v-7.041h-7.041v7.041h7.041zM28 10.479h-7.041v7.041H28v3.439h-7.041V28H17.52v-7.041h-7.041V28H7.04v-7.041H-.001V17.52H7.04v-7.041H-.001V7.04H7.04V-.001h3.439V7.04h7.041V-.001h3.439V7.04H28v3.439z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_timer" xmlns="http://www.w3.org/2000/svg"><path d="M16 29q4.428 0 7.536-3.143t3.107-7.571-3.107-7.536T16 7.643 8.464 10.75t-3.107 7.536 3.107 7.571T16 29zM26.714 9.786q1.214 1.571 2.107 4.036t.893 4.464q0 5.643-4 9.678T16 32t-9.714-4.036-4-9.678 4-9.678T16 4.572q1.929 0 4.464.929t4.107 2.143l2.143-2.214q1.143.929 2.143 2.143zM14.5 19.857v-9.143h3v9.143h-3zM20.571.001v3.071h-9.143V.001h9.143z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_xmpp" xmlns="http://www.w3.org/2000/svg"><path d="M31.995 4.237c-.449.175-1.12.433-1.936.745-1.544.591-2.328.891-2.924 1.093-.613.208-1.287.409-2.635.813-.911.272-1.672.495-2.212.651-.031.875 0 2.177-.292 3.635a21.837 21.837 0 0 1-2.016 5.765c-1.496 2.944-3.236 4.817-3.88 5.476-.056-.059-.112-.117-.168-.179-.707-.763-2.403-2.703-3.815-5.683-1.053-2.223-1.484-4.044-1.605-4.584-.356-1.589-.427-2.955-.427-4.117 0-.075-.036-.129-.101-.149-.721-.223-1.765-.519-2.887-.853-1.271-.379-2.193-.744-3.408-1.2-.493-.185-1.409-.547-2.217-.859C.723 4.499.113 4.236.041 4.236c-.005 0-.015 0-.023.012a.131.131 0 0 0-.019.076c.009.593.08 1.361.256 2.365.615 3.503 2.688 7.061 4.36 9.244 0 0 3.717 5.035 9.128 8.144l.303.176c-.009.008-.02.015-.028.021-1.717 1.316-3.201 1.977-3.579 2.14a15.71 15.71 0 0 1-2.219.772v.407a25.31 25.31 0 0 0 2.72-.487 26.72 26.72 0 0 0 5.075-1.792c.136.067.276.136.42.204 1.527.725 3.571 1.627 6.073 2.048.613.103 1.136.165 1.507.195a.109.109 0 0 0 .115-.091.55.55 0 0 0 .004-.217.107.107 0 0 0-.063-.073c-.505-.209-1.201-.4-1.983-.719-.935-.381-2.241-1.067-3.648-2.128a13.528 13.528 0 0 1-.367-.287c4.64-2.656 7.989-6.588 7.989-6.588 1.735-2.036 4.441-5.623 5.431-9.795.349-1.473.539-2.741.5-3.628z"/></svg></defs></svg>




    <div
      class="wrapper "
    >
      
      <header class="gdoc-header">
  <div class="container flex align-center justify-between">
    
      <label for="menu-control" class="gdoc-nav__control">
        <div tabindex="0" role="button" aria-pressed="false">
          <input type="checkbox" class="hidden" id="menu-control" />

          <svg class="gdoc-icon gdoc_menu">
            <title>Open Navigation</title>
            <use xlink:href="#gdoc_menu"></use>
          </svg>
          <svg class="gdoc-icon gdoc_arrow_back">
            <title>Close Navigation</title>
            <use xlink:href="#gdoc_arrow_back"></use>
          </svg>
        </div>
      </label>
    
    <div>
      <a class="gdoc-brand gdoc-header__link" href="http://localhost:1313/">
        <span class="flex align-center">
          <img
            class="gdoc-brand__img"
            src="/brand.svg"
            alt=""
          />
          <span class="gdoc-brand__title">raphi&#39;s corner</span>
        </span>
      </a>
    </div>
    <div class="gdoc-menu-header flex gap-16">
      <span class="gdoc-menu-header__items">
        


        <span id="gdoc-color-theme" tabindex="0" role="button" aria-pressed="false">
          <svg class="gdoc-icon gdoc_brightness_dark">
            <title>Toggle Dark/Light/Auto mode</title>
            <use xlink:href="#gdoc_brightness_dark"></use>
          </svg>
          <svg class="gdoc-icon gdoc_brightness_light">
            <title>Toggle Dark/Light/Auto mode</title>
            <use xlink:href="#gdoc_brightness_light"></use>
          </svg>
          <svg class="gdoc-icon gdoc_brightness_auto">
            <title>Toggle Dark/Light/Auto mode</title>
            <use xlink:href="#gdoc_brightness_auto"></use>
          </svg>
        </span>

        <span class="gdoc-menu-header__home">
          <a href="http://localhost:1313/" class="gdoc-header__link">
            <svg class="gdoc-icon gdoc_home">
              <title>Back to homepage</title>
              <use xlink:href="#gdoc_home"></use>
            </svg>
          </a>
        </span>

        

      </span>
      <span class="gdoc-menu-header__control">
        <label for="menu-header-control">
          <div tabindex="0" role="button" aria-pressed="false">
            <input type="checkbox" class="hidden" id="menu-header-control" />

            <svg class="gdoc-icon gdoc_keyboard_arrow_right">
              <use xlink:href="#gdoc_keyboard_arrow_right"></use>
              <title>Close Menu Bar</title>
            </svg>

            <svg class="gdoc-icon gdoc_keyboard_arrow_left">
              <use xlink:href="#gdoc_keyboard_arrow_left"></use>
              <title>Open Menu Bar</title>
            </svg>
          </div>
        </label>
      </span>
    </div>
  </div>
</header>



      <main class="container flex flex-even">
        
          <aside class="gdoc-nav">
            <nav>
  
  <div class="gdoc-search flex align-center">
    <svg class="gdoc-icon gdoc_search"><use xlink:href="#gdoc_search"></use></svg>
    <input
      type="text"
      id="gdoc-search-input"
      class="gdoc-search__input"
      placeholder="Search..."
      aria-label="Search"
      maxlength="64"
      data-site-base-url="http://localhost:1313/"
      data-site-lang="en"
    />
    <ul id="gdoc-search-results" class="gdoc-search__list"></ul>
  </div>




  <section class="gdoc-nav--main">
    <h2>Navigation</h2>
    
      

  


  <ul class="gdoc-nav__list">
    
    
      

      

      
        
          
          
          
          
          
          


          <li>
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              
                <span class="flex">Oracle</span>
              
              
            </label>

            
              
  


  <ul class="gdoc-nav__list">
    
    
      

      

      
        
          
          
          
          
          
          


          <li>
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              
                <span class="flex">
                  <a
                    href="/oracle/ash/"
                    class="gdoc-nav__entry"
                  >
                    active session history
                  </a>
                </span>
              
              
            </label>

            
          </li>
        
      
    
      

      

      
        
          
          
          
          
          
          


          <li>
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              
                <span class="flex">
                  <a
                    href="/oracle/ashtop/"
                    class="gdoc-nav__entry"
                  >
                    ashtop
                  </a>
                </span>
              
              
            </label>

            
          </li>
        
      
    
  </ul>

            
          </li>
        
      
        
          
          
          
          
          
          


          <li>
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              
                <span class="flex">Postgres</span>
              
              
            </label>

            
              
  


  <ul class="gdoc-nav__list">
    
    
      

      

      
        
          
          
          
          
          
          


          <li>
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              
                <span class="flex">
                  <a
                    href="/postgres/pgbench/"
                    class="gdoc-nav__entry"
                  >
                    pgbench
                  </a>
                </span>
              
              
            </label>

            
          </li>
        
      
        
          
          
          
          
          
          


          <li>
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              
                <span class="flex">
                  <a
                    href="/postgres/pgstat_snap/"
                    class="gdoc-nav__entry is-active"
                  >
                    pgstat_snap
                  </a>
                </span>
              
              
            </label>

            
          </li>
        
      
    
  </ul>

            
          </li>
        
      
        
          
          
          
          
          
          


          <li>
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              
                <span class="flex">Stuff</span>
              
              
            </label>

            
              
  


  <ul class="gdoc-nav__list">
    
    
      

      

      
        
          
          
          
          
          
          


          <li>
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              
                <span class="flex">
                  <a
                    href="/stuff/stuff/"
                    class="gdoc-nav__entry"
                  >
                    other stuff
                  </a>
                </span>
              
              
            </label>

            
          </li>
        
      
    
  </ul>

            
          </li>
        
      
    
  </ul>






    
  </section>

  


  <section class="gdoc-nav--more">
    
  </section>
</nav>

          </aside>
        


        <div class="gdoc-page">
          
  <article class="gdoc-post" id="main-content" tabindex="-1">
    <header class="gdoc-post__header">
      <h1 class="gdoc-post__title">pgstat_snap</h1>
      <div class="flex flex-wrap align-center gdoc-post__meta gdoc-post__meta--head">
        <span class="flex align-center no-wrap">
  <svg class="gdoc-icon gdoc_date"><use xlink:href="#gdoc_date"></use></svg>
  <span class="gdoc-post__tag">
    <time datetime="2025-07-08T23:30:37&#43;02:00">
      
        Updated on
      
      Jul 8, 2025
    </time>
  </span>
</span>

<span class="flex align-center no-wrap">
  <svg class="gdoc-icon gdoc_timer"><use xlink:href="#gdoc_timer"></use></svg>
  <span class="gdoc-post__tag">8 minutes to read</span>
</span>






      </div>
    </header>
    <section class="gdoc-markdown">
      <div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="purpose-of-this-script"
    >
        Purpose of this script
    </h1>
    <a data-clipboard-text="http://localhost:1313/postgres/pgstat_snap/#purpose-of-this-script" class="gdoc-page__anchor clip flex align-center" title="Anchor to: Purpose of this script" aria-label="Anchor to: Purpose of this script" href="#purpose-of-this-script">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>The cumulative statistics system (CSS) in PostgreSQL and pg_stat_statements in particular lack any timing information, all values are cumulative and the only way to figure out the difference between query executions is to reset the stats every time or work with averages.</p>
<p>With the pgstat_snap extension, you can create timestamped snapshots of pg_stat_statements and pg_stat_activity when needed. It also provides views that show the difference between every snapshot for every query and database.</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="requirements"
    >
        Requirements
    </h1>
    <a data-clipboard-text="http://localhost:1313/postgres/pgstat_snap/#requirements" class="gdoc-page__anchor clip flex align-center" title="Anchor to: Requirements" aria-label="Anchor to: Requirements" href="#requirements">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>pg_stat_statements must be loaded and tracking activated in the postgres config:</p>
<pre tabindex="0"><code>shared_preload_libraries = &#39;pg_stat_statements&#39;
</code></pre><p>Recommended settings:</p>
<pre tabindex="0"><code>pg_stat_statements.track = all  
pg_stat_statements.track_utility = off
</code></pre><p>The extension has to be created in the database in which pgstat_snap will be installed:</p>
<pre tabindex="0"><code>create extension pg_stat_statements;
</code></pre><div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="installation"
    >
        Installation
    </h1>
    <a data-clipboard-text="http://localhost:1313/postgres/pgstat_snap/#installation" class="gdoc-page__anchor clip flex align-center" title="Anchor to: Installation" aria-label="Anchor to: Installation" href="#installation">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>To install the extension, download these files:</p>
<pre tabindex="0"><code>pgstat_snap--1.0.sql
pgstat_snap.control
</code></pre><p>And copy them to the extension directory of PostgreSQL</p>
<pre tabindex="0"><code>sudo cp pgstat_snap* $(pg_config --sharedir)/extension/
</code></pre><p>You can then install the extension in any database that has the pg_stat_statements extension enabled, superuser right are NOT needed:</p>
<pre tabindex="0"><code>create extension pgstat_snap;
</code></pre><p>It can also be installed into a different schema but be sure to have it included in the search_path:</p>
<pre tabindex="0"><code>create extension pgstat_snap schema my_schema;
</code></pre><p>This will create the following tables and views:</p>
<pre tabindex="0"><code>  pgstat_snap_stat_history   -&gt; pg_stat_statements history (complete snapshot)
  pgstat_snap_act_history    -&gt; pg_stat_activity history (complete snapshot)
  pgstat_snap_diff_all       -&gt; view containing the sum and difference of each statement between snapshots
  pgstat_snap_diff           -&gt; view containing only the difference of each statement between snapshots
</code></pre><div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="usage"
    >
        Usage
    </h1>
    <a data-clipboard-text="http://localhost:1313/postgres/pgstat_snap/#usage" class="gdoc-page__anchor clip flex align-center" title="Anchor to: Usage" aria-label="Anchor to: Usage" href="#usage">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>Start gathering snapshots with, e.g. every 1 second 60 times:</p>
<pre tabindex="0"><code>CALL pgstat_snap_collect(1, 60);
</code></pre><p>Or gather a snapshot every 5 seconds for 10 minutes:</p>
<pre tabindex="0"><code>CALL pgstat_snap_collect(5, 120);
</code></pre><p><strong>IMPORTANT:</strong> on very busy clusters with many databases a lot of data can be collected, 500mb per minute or more. Don&rsquo;t let it run for a very long time with short intervals, unless you have the disk space for it.</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="reset"
    >
        Reset
    </h2>
    <a data-clipboard-text="http://localhost:1313/postgres/pgstat_snap/#reset" class="gdoc-page__anchor clip flex align-center" title="Anchor to: Reset" aria-label="Anchor to: Reset" href="#reset">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>Because everything is timestamped, a reset is usually not needed between CALLs to create_snapshot. But you can to cleanup and keep the tables smaller. You can also reset pg_stats*.</p>
<p>Reset all pgstat_snap tables with:</p>
<pre tabindex="0"><code>  SELECT pgstat_snap_reset();   -&gt; reset only pgstat_snap.pgstat*history tables
  SELECT pgstat_snap_reset(1);  -&gt; also select pg_stat_statements_reset()
  SELECT pgstat_snap_reset(2);  -&gt; also select pg_stat_reset()
</code></pre><div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="how-it-works"
    >
        How it works
    </h1>
    <a data-clipboard-text="http://localhost:1313/postgres/pgstat_snap/#how-it-works" class="gdoc-page__anchor clip flex align-center" title="Anchor to: How it works" aria-label="Anchor to: How it works" href="#how-it-works">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>The first argument to create_snapshot is the interval in seconds, the second argument is how many snapshots should be collected. Every <em>interval</em> seconds, <em>select * from pg_stat_statements</em> will be inserted into <em>pgstat_snap_stat_history</em> and <em>select * from pgstat_act_statements</em> into <em>pgstat_snap_act_history</em>.</p>
<p>For every row, a timestamp will be added. Only rows where the &ldquo;rows&rdquo; column has changed will be inserted into <em>pgstat_snap_stat_history</em> and always only one row per timestamp, dbid and queryid. Every insert is immediately committed to be able to live follow the tables/views.</p>
<p>The views have a <em>_d</em> column which displays the difference between the current row and the last row where the query was recorded in the pgstat_snap_stat_history table. <em>NULL</em> values in <em>rows_d</em>, <em>calls_d</em> and so on mean, that no previous row for this query was found because it was executed the first time since create_snapshot was running.</p>
<p>The views also contain the datname, wait events and the first 20 characters of the query, making it easier to identify queries of interest.</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="uninstall"
    >
        Uninstall
    </h1>
    <a data-clipboard-text="http://localhost:1313/postgres/pgstat_snap/#uninstall" class="gdoc-page__anchor clip flex align-center" title="Anchor to: Uninstall" aria-label="Anchor to: Uninstall" href="#uninstall">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>To completely uninstall pgstat_snap, run:</p>
<pre tabindex="0"><code>DROP EXTENSION pgstat_snap;
</code></pre><div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="views-description"
    >
        Views description
    </h1>
    <a data-clipboard-text="http://localhost:1313/postgres/pgstat_snap/#views-description" class="gdoc-page__anchor clip flex align-center" title="Anchor to: Views description" aria-label="Anchor to: Views description" href="#views-description">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="pgstat_snap_diff"
    >
        pgstat_snap_diff
    </h2>
    <a data-clipboard-text="http://localhost:1313/postgres/pgstat_snap/#pgstat_snap_diff" class="gdoc-page__anchor clip flex align-center" title="Anchor to: pgstat_snap_diff" aria-label="Anchor to: pgstat_snap_diff" href="#pgstat_snap_diff">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>This view only contains the difference between the previous and next execution of a queryid/dbid pair:</p>
<div class="table-wrap"> <table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>snapshot_time</strong></td>
          <td>Timestamp</td>
      </tr>
      <tr>
          <td><strong>queryid</strong></td>
          <td>Query ID</td>
      </tr>
      <tr>
          <td><strong>query</strong></td>
          <td>Query Text (first 20 characters)</td>
      </tr>
      <tr>
          <td><strong>datname</strong></td>
          <td>Database Name</td>
      </tr>
      <tr>
          <td><strong>usename</strong></td>
          <td>Username</td>
      </tr>
      <tr>
          <td><strong>wait_event_type</strong></td>
          <td>Event Type - NULL if no wait occurred</td>
      </tr>
      <tr>
          <td><strong>wait_event</strong></td>
          <td>Wait Event - NULL if no wait occurred</td>
      </tr>
      <tr>
          <td><strong>rows_d</strong></td>
          <td>Difference in rows from the previous snapshot_time</td>
      </tr>
      <tr>
          <td><strong>calls_d</strong></td>
          <td>Difference in calls from the previous snapshot_time</td>
      </tr>
      <tr>
          <td><strong>exec_ms_d</strong></td>
          <td>Difference in total execution time from the previous snapshot_time</td>
      </tr>
      <tr>
          <td><strong>sb_hit_d</strong></td>
          <td>Difference in shared block hits from the previous snapshot_time</td>
      </tr>
      <tr>
          <td><strong>sb_read_d</strong></td>
          <td>Difference in shared block reads from the previous snapshot_time</td>
      </tr>
      <tr>
          <td><strong>sb_dirt_d</strong></td>
          <td>Difference in shared blocks dirtied from the previous snapshot_time</td>
      </tr>
      <tr>
          <td><strong>sb_write_d</strong></td>
          <td>Difference in shared blocks written from the previous snapshot_time</td>
      </tr>
  </tbody>
</table> </div>
<div class="flex align-center gdoc-page__anchorwrap">
    <h3 id="sample-output"
    >
        Sample output
    </h3>
    <a data-clipboard-text="http://localhost:1313/postgres/pgstat_snap/#sample-output" class="gdoc-page__anchor clip flex align-center" title="Anchor to: Sample output" aria-label="Anchor to: Sample output" href="#sample-output">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<pre tabindex="0"><code>select * from pgstat_snap_diff order by 1;
</code></pre><div class="table-wrap"> <table>
  <thead>
      <tr>
          <th>snapshot_time</th>
          <th>queryid</th>
          <th>query</th>
          <th>datname</th>
          <th>usename</th>
          <th>wait_event_type</th>
          <th>wait_event</th>
          <th>rows_d</th>
          <th>calls_d</th>
          <th>exec_ms_d</th>
          <th>sb_hit_d</th>
          <th>sb_read_d</th>
          <th>sb_dirt_d</th>
          <th>sb_write_d</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2025-03-25 11:00:19</td>
          <td>4380144606300689468</td>
          <td>UPDATE pgbench_tell</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>4485</td>
          <td>4485</td>
          <td>986.262098</td>
          <td>22827</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:20</td>
          <td>4380144606300689468</td>
          <td>UPDATE pgbench_tell</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>1204</td>
          <td>1204</td>
          <td>228.822413</td>
          <td>6115</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:20</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>1204</td>
          <td>1204</td>
          <td>1758.190499</td>
          <td>5655</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:21</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>1273</td>
          <td>1273</td>
          <td>2009.227575</td>
          <td>6024</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:22</td>
          <td>2931033680287349001</td>
          <td>UPDATE pgbench_acco</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Client</td>
          <td>ClientRead</td>
          <td>9377</td>
          <td>9377</td>
          <td>1818.464415</td>
          <td>66121</td>
          <td>3699</td>
          <td>7358</td>
          <td>35</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:22</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>1356</td>
          <td>1356</td>
          <td>1659.806856</td>
          <td>6341</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:23</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>1168</td>
          <td>1168</td>
          <td>1697.322874</td>
          <td>5484</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:24</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>[NULL]</td>
          <td>[NULL]</td>
          <td>1135</td>
          <td>1135</td>
          <td>1539.999618</td>
          <td>5237</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:24</td>
          <td>5744520630148654507</td>
          <td>SELECT abalance FROM</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>[NULL]</td>
          <td>[NULL]</td>
          <td>11679</td>
          <td>11679</td>
          <td>114.347514</td>
          <td>49451</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:25</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>1274</td>
          <td>1274</td>
          <td>1861.747733</td>
          <td>6043</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:26</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>1080</td>
          <td>1080</td>
          <td>1855.803660</td>
          <td>5080</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:27</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>1155</td>
          <td>1155</td>
          <td>1669.499608</td>
          <td>5373</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:27</td>
          <td>7113545590461720994</td>
          <td>SELECT CASE WHEN pg</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Client</td>
          <td>ClientRead</td>
          <td>1</td>
          <td>1</td>
          <td>0.098783</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:28</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>1178</td>
          <td>1178</td>
          <td>1623.365492</td>
          <td>5466</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:29</td>
          <td>2931033680287349001</td>
          <td>UPDATE pgbench_acco</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Client</td>
          <td>ClientRead</td>
          <td>8350</td>
          <td>8350</td>
          <td>1456.806356</td>
          <td>58400</td>
          <td>3317</td>
          <td>6135</td>
          <td>30</td>
      </tr>
  </tbody>
</table> </div>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="pgstat_snap_diff_all"
    >
        pgstat_snap_diff_all
    </h2>
    <a data-clipboard-text="http://localhost:1313/postgres/pgstat_snap/#pgstat_snap_diff_all" class="gdoc-page__anchor clip flex align-center" title="Anchor to: pgstat_snap_diff_all" aria-label="Anchor to: pgstat_snap_diff_all" href="#pgstat_snap_diff_all">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>This view contains the difference between the previous and next execution of a queryid/dbid pair and the sum of the fields as recorded in pg_stat_statements at that time:</p>
<div class="table-wrap"> <table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>snapshot_time</strong></td>
          <td>Timestamp</td>
      </tr>
      <tr>
          <td><strong>queryid</strong></td>
          <td>Query ID</td>
      </tr>
      <tr>
          <td><strong>query</strong></td>
          <td>Query Text (first 20 characters)</td>
      </tr>
      <tr>
          <td><strong>datname</strong></td>
          <td>Database Name</td>
      </tr>
      <tr>
          <td><strong>usename</strong></td>
          <td>Username</td>
      </tr>
      <tr>
          <td><strong>wait_event_type</strong></td>
          <td>Event Type - NULL if no wait occurred</td>
      </tr>
      <tr>
          <td><strong>wait_event</strong></td>
          <td>Wait Event - NULL if no wait occurred</td>
      </tr>
      <tr>
          <td><strong>rows</strong></td>
          <td>Value of rows at this time in pg_stat_statements</td>
      </tr>
      <tr>
          <td><strong>rows_d</strong></td>
          <td>Difference in rows from the previous snapshot_time</td>
      </tr>
      <tr>
          <td><strong>calls</strong></td>
          <td>Value of calls at this time in pg_stat_statements</td>
      </tr>
      <tr>
          <td><strong>calls_d</strong></td>
          <td>Difference in calls from the previous snapshot_time</td>
      </tr>
      <tr>
          <td><strong>exec_ms</strong></td>
          <td>Value of total execution time at this time in pg_stat_statements</td>
      </tr>
      <tr>
          <td><strong>exec_ms_d</strong></td>
          <td>Difference in total execution time from the previous snapshot_time</td>
      </tr>
      <tr>
          <td><strong>sb_hit</strong></td>
          <td>Value of shared block hits at this time in pg_stat_statements</td>
      </tr>
      <tr>
          <td><strong>sb_hit_d</strong></td>
          <td>Difference in shared block hits from the previous snapshot_time</td>
      </tr>
      <tr>
          <td><strong>sb_read</strong></td>
          <td>Value of shared block reads at this time in pg_stat_statements</td>
      </tr>
      <tr>
          <td><strong>sb_read_d</strong></td>
          <td>Difference in shared block reads from the previous snapshot_time</td>
      </tr>
      <tr>
          <td><strong>sb_dirt</strong></td>
          <td>Value of shared blocks dirtied at this time in pg_stat_statements</td>
      </tr>
      <tr>
          <td><strong>sb_dirt_d</strong></td>
          <td>Difference in shared blocks dirtied from the previous snapshot_time</td>
      </tr>
      <tr>
          <td><strong>sb_write</strong></td>
          <td>Value of shared blocks written at this time in pg_stat_statements</td>
      </tr>
      <tr>
          <td><strong>sb_write_d</strong></td>
          <td>Difference in shared blocks written from the previous snapshot_time</td>
      </tr>
  </tbody>
</table> </div>
<div class="flex align-center gdoc-page__anchorwrap">
    <h3 id="sample-output-1"
    >
        Sample output
    </h3>
    <a data-clipboard-text="http://localhost:1313/postgres/pgstat_snap/#sample-output-1" class="gdoc-page__anchor clip flex align-center" title="Anchor to: Sample output" aria-label="Anchor to: Sample output" href="#sample-output-1">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<pre tabindex="0"><code>select * from pgstat_snap_diff_all order by 1;
</code></pre><div class="table-wrap"> <table>
  <thead>
      <tr>
          <th>snapshot_time</th>
          <th>queryid</th>
          <th>query</th>
          <th>datname</th>
          <th>usename</th>
          <th>wait_event_type</th>
          <th>wait_event</th>
          <th>rows</th>
          <th>rows_d</th>
          <th>calls</th>
          <th>calls_d</th>
          <th>exec_ms</th>
          <th>exec_ms_d</th>
          <th>sb_hit</th>
          <th>sb_hit_d</th>
          <th>sb_read</th>
          <th>sb_read_d</th>
          <th>sb_dirt</th>
          <th>sb_dirt_d</th>
          <th>sb_write</th>
          <th>sb_write_d</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2025-03-25 11:00:19</td>
          <td>4380144606300689468</td>
          <td>UPDATE pgbench_tell</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>241818</td>
          <td>4485</td>
          <td>241818</td>
          <td>4485</td>
          <td>39693.679945</td>
          <td>986.262098</td>
          <td>1237102</td>
          <td>1237098</td>
          <td>4</td>
          <td>0</td>
          <td>90</td>
          <td>0</td>
          <td>22</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:20</td>
          <td>4380144606300689468</td>
          <td>UPDATE pgbench_tell</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>243022</td>
          <td>1204</td>
          <td>243022</td>
          <td>1204</td>
          <td>39922.502358</td>
          <td>228.822413</td>
          <td>1243217</td>
          <td>1243213</td>
          <td>4</td>
          <td>0</td>
          <td>90</td>
          <td>0</td>
          <td>22</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:20</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>243020</td>
          <td>1204</td>
          <td>243020</td>
          <td>1204</td>
          <td>322868.346002</td>
          <td>1758.190499</td>
          <td>1142441</td>
          <td>1142440</td>
          <td>1</td>
          <td>0</td>
          <td>71</td>
          <td>0</td>
          <td>21</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:21</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>244293</td>
          <td>1273</td>
          <td>244293</td>
          <td>1273</td>
          <td>324877.573577</td>
          <td>2009.227575</td>
          <td>1148465</td>
          <td>1148464</td>
          <td>1</td>
          <td>0</td>
          <td>71</td>
          <td>0</td>
          <td>21</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:22</td>
          <td>2931033680287349001</td>
          <td>UPDATE pgbench_acco</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Client</td>
          <td>ClientRead</td>
          <td>245652</td>
          <td>9377</td>
          <td>245652</td>
          <td>9377</td>
          <td>51188.172394</td>
          <td>1818.464415</td>
          <td>2140583</td>
          <td>2022215</td>
          <td>122067</td>
          <td>3699</td>
          <td>233128</td>
          <td>7358</td>
          <td>2150</td>
          <td>35</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:22</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>245649</td>
          <td>1356</td>
          <td>245649</td>
          <td>1356</td>
          <td>326537.380433</td>
          <td>1659.806856</td>
          <td>1154806</td>
          <td>1154805</td>
          <td>1</td>
          <td>0</td>
          <td>71</td>
          <td>0</td>
          <td>21</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:23</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>246817</td>
          <td>1168</td>
          <td>246817</td>
          <td>1168</td>
          <td>328234.703307</td>
          <td>1697.322874</td>
          <td>1160290</td>
          <td>1160289</td>
          <td>1</td>
          <td>0</td>
          <td>71</td>
          <td>0</td>
          <td>21</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:24</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>[NULL]</td>
          <td>[NULL]</td>
          <td>247952</td>
          <td>1135</td>
          <td>247952</td>
          <td>1135</td>
          <td>329774.702925</td>
          <td>1539.999618</td>
          <td>1165527</td>
          <td>1165526</td>
          <td>1</td>
          <td>0</td>
          <td>71</td>
          <td>0</td>
          <td>21</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:24</td>
          <td>5744520630148654507</td>
          <td>SELECT abalance FROM</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>[NULL]</td>
          <td>[NULL]</td>
          <td>247954</td>
          <td>11679</td>
          <td>247954</td>
          <td>11679</td>
          <td>2917.940273</td>
          <td>114.347514</td>
          <td>1121749</td>
          <td>1121749</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:25</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>249226</td>
          <td>1274</td>
          <td>249226</td>
          <td>1274</td>
          <td>331636.450658</td>
          <td>1861.747733</td>
          <td>1171570</td>
          <td>1171569</td>
          <td>1</td>
          <td>0</td>
          <td>71</td>
          <td>0</td>
          <td>21</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:26</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>250306</td>
          <td>1080</td>
          <td>250306</td>
          <td>1080</td>
          <td>333492.254318</td>
          <td>1855.803660</td>
          <td>1176650</td>
          <td>1176649</td>
          <td>1</td>
          <td>0</td>
          <td>71</td>
          <td>0</td>
          <td>21</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:27</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>251461</td>
          <td>1155</td>
          <td>251461</td>
          <td>1155</td>
          <td>335161.753926</td>
          <td>1669.499608</td>
          <td>1182023</td>
          <td>1182022</td>
          <td>1</td>
          <td>0</td>
          <td>71</td>
          <td>0</td>
          <td>21</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:27</td>
          <td>7113545590461720994</td>
          <td>SELECT CASE WHEN pg</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Client</td>
          <td>ClientRead</td>
          <td>3783</td>
          <td>1</td>
          <td>3783</td>
          <td>1</td>
          <td>373.398846</td>
          <td>0.098783</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:28</td>
          <td>7073332947325598809</td>
          <td>UPDATE pgbench_bran</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Lock</td>
          <td>transactionid</td>
          <td>252639</td>
          <td>1178</td>
          <td>252639</td>
          <td>1178</td>
          <td>336785.119418</td>
          <td>1623.365492</td>
          <td>1187489</td>
          <td>1187488</td>
          <td>1</td>
          <td>0</td>
          <td>71</td>
          <td>0</td>
          <td>21</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2025-03-25 11:00:29</td>
          <td>2931033680287349001</td>
          <td>UPDATE pgbench_acco</td>
          <td>postgres</td>
          <td>postgres</td>
          <td>Client</td>
          <td>ClientRead</td>
          <td>254002</td>
          <td>8350</td>
          <td>254002</td>
          <td>8350</td>
          <td>52644.978750</td>
          <td>1456.806356</td>
          <td>2198983</td>
          <td>2076916</td>
          <td>125384</td>
          <td>3317</td>
          <td>239263</td>
          <td>6135</td>
          <td>2180</td>
          <td>30</td>
      </tr>
  </tbody>
</table> </div>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="query-examples"
    >
        Query Examples
    </h1>
    <a data-clipboard-text="http://localhost:1313/postgres/pgstat_snap/#query-examples" class="gdoc-page__anchor clip flex align-center" title="Anchor to: Query Examples" aria-label="Anchor to: Query Examples" href="#query-examples">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>Depending on screensize, you might want to set format to aligned, especially when querying <em>pstat_snap_diff_all</em>:</p>
<pre tabindex="0"><code>\pset format aligned
</code></pre><p>What was happening:</p>
<pre tabindex="0"><code>select * from pgstat_snap_diff order by 1;
</code></pre><p>What was every query doing:</p>
<pre tabindex="0"><code>select * from pgstat_snap_diff order by 2,1;
</code></pre><p>Which database touched the most rows:</p>
<pre tabindex="0"><code>select sum(rows_d),datname from pgstat_snap_diff group by datname;
</code></pre><p>Which query DML affected the most rows:</p>
<pre tabindex="0"><code>select sum(rows_d),queryid,query from pgstat_snap_diff where upper(query) not like &#39;SELECT%&#39; group by queryid,query;
</code></pre><p>What wait events happened which weren&rsquo;t of type Client:</p>
<pre tabindex="0"><code>select * from pgstat_snap_diff where wait_event_type is not null and wait_event_type &lt;&gt; &#39;Client&#39; order by 2,1;
</code></pre><p>If needed you can access all columns for a particular query directly in the history tables:</p>
<pre tabindex="0"><code>select * from pgstat_snap_stat_history where queryid=&#39;123455678909876&#39;;
</code></pre>
    </section>
  </article>



          
          
          <div class="gdoc-page__footer flex flex-wrap justify-between">
            
              








  
  

  
  
    

    

    
      
      

      
        
        
        
        

        
        

        

        

        

        
        
          
  
  

  
  
    

    

    
      
      

      
        
        
        
        

        
        

        

        

        
          
        

        
        
      
    

  
    

    

    
      
      

      
        
        
        
        

        
        

        

        

        
          
        

        
        
      
    

  

        
      
    
      
      

      
        
        
        
        

        
        

        

        

        

        
        
          
  
  

  
  
    

    

    
      
      

      
        
        
        
        

        
        

        

        

        
          
        

        
        
      
    
      
      

      
        
        
        
        

        
        

        

        
          
          
        

        
          
        

        
        
      
    

  

        
      
    
      
      

      
        
        
        
        

        
        

        
          
        

        

        

        
        
          
  
  

  
  
    

    

    
      
      

      
        
        
        
        

        
        

        
          
            
            
          
        

        

        
          
        

        
        
      
    

  

        
      
    

  




<span class="gdoc-page__nav">
  
    <a
      class="gdoc-page__nav--prev flex align-center"
      href="/postgres/pgbench/"
      title="pgbench"
    >
      <i class="gdoc-icon">gdoc_arrow_left_alt</i>
      pgbench
    </a>
  
</span>
<span class="gdoc-page__nav">
  
    <a
      class="gdoc-page__nav--next flex align-center"
      href="/stuff/stuff/"
      title="other stuff"
    >
      other stuff
      <i class="gdoc-icon">gdoc_arrow_right_alt</i>
    </a>
  
</span>

            
          </div>
          
        </div>
      </main>

      <footer class="gdoc-footer">
  <nav class="container flex">
    <div>
      <section class="flex flex-wrap align-center">
        <span class="gdoc-footer__item gdoc-footer__item--row">
          Built with <a href="https://gohugo.io/" class="gdoc-footer__link">Hugo</a> and <svg class="gdoc-icon gdoc_heart"><use xlink:href="#gdoc_heart"></use></svg>

        </span>
        
        
      </section>
      
    </div>
    
      <div class="flex flex-25 justify-end">
        <span class="gdoc-footer__item text-right">
          <a class="gdoc-footer__link fake-link" href="#" aria-label="Back to top">
            <svg class="gdoc-icon gdoc_keyboard_arrow_up">
              <use xlink:href="#gdoc_keyboard_arrow_up"></use>
            </svg>
            <span class="hidden-mobile">Back to top</span>
          </a>
        </span>
      </div>
    
  </nav>
</footer>

    </div>

    
  <script defer src="/js/search-16a110ff.bundle.min.js"></script>

  </body>
</html>
