<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>ashtop | crashdump</title>
<meta name="description" content="Usage and examples for Tanel Poder&#39;s ashtop, the fastest way to query ASH">
<meta property="og:url" content="http://localhost:1313/oracle/ashtop/">
  <meta property="og:site_name" content="crashdump">
  <meta property="og:title" content="ashtop">
  <meta property="og:description" content="Usage and examples for Tanel Poder&#39;s ashtop, the fastest way to query ASH">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="oracle">
    <meta property="article:modified_time" content="2025-07-09T21:44:03+02:00">

  <meta itemprop="name" content="ashtop">
  <meta itemprop="description" content="Usage and examples for Tanel Poder&#39;s ashtop, the fastest way to query ASH">
  <meta itemprop="dateModified" content="2025-07-09T21:44:03+02:00">
  <meta itemprop="wordCount" content="2094">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="ashtop">
  <meta name="twitter:description" content="Usage and examples for Tanel Poder&#39;s ashtop, the fastest way to query ASH">
<link href="/scss/main.css" rel="stylesheet">
<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>

  </head>
  <body class="td-page">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg width="60" height="0" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="monospace" font-size="64" font-type="bold" fill="#fff">ok#</text></svg></span><span class="navbar-brand__name">crashdump</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="https://www.postgresql.org/docs/" target="_blank" rel="noopener"><span>Postgres documentation</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://docs.oracle.com/en/database/oracle/oracle-database/index.html" target="_blank" rel="noopener"><span>Oracle documentation</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://www.perplexity.ai/" target="_blank" rel="noopener"><span>Perplexity</span></a>
      </li>
      <li class="td-light-dark-menu nav-item dropdown">
        <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="check2" viewBox="0 0 16 16">
    <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
  </symbol>
  <symbol id="circle-half" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
  </symbol>
  <symbol id="moon-stars-fill" viewBox="0 0 16 16">
    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
    <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
  </symbol>
  <symbol id="sun-fill" viewBox="0 0 16 16">
    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
  </symbol>
</svg>

<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center"
        id="bd-theme"
        type="button"
        aria-expanded="false"
        data-bs-toggle="dropdown"
        data-bs-display="static"
        aria-label="Toggle theme (auto)">
  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg>
</button>
<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#sun-fill"></use></svg>
      Light
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"></use></svg>
      Dark
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
      <svg class="bi me-2 opacity-50"><use href="#circle-half"></use></svg>
      Auto
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
</ul>

      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            <div id="td-sidebar-menu" class="td-sidebar__inner">
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type="button" data-bs-toggle="collapse" data-bs-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  <nav class="td-sidebar-nav collapse" id="td-section-nav">
    <ul class="td-sidebar-nav__section pe-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m--li">
  <a href="/" title="Hi there!" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-"><span class="">Home</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-postgres-li">
  <a href="/postgres/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-postgres"><span class="">PostgreSQL</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postgrespgbench-li">
  <a href="/postgres/pgbench/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-postgrespgbench"><span class="">pgbench</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postgrespgstat_snap-li">
  <a href="/postgres/pgstat_snap/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-postgrespgstat_snap"><span class="">pgstat_snap</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-oracle-li">
  <a href="/oracle/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-oracle"><span class="">Oracle</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-oracleash-li">
  <a href="/oracle/ash/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-oracleash"><span class="">Active Session History</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-oracleashtop-li">
  <a href="/oracle/ashtop/" class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id="m-oracleashtop"><span class="td-sidebar-nav-active-item">ashtop</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-stuff-li">
  <a href="/stuff/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-stuff"><span class="">Other stuff</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-stuffstuff-li">
  <a href="/stuff/stuff/" title="other stuff" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-stuffstuff"><span class="">Other stuff</span></a>
</li>
  </ul>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            <div class="td-page-meta ms-2 pb-1 pt-2 mb-0">
<a href="https://github.com/raphideb/raphideb.github.io/tree/main/content/oracle/ashtop.md" class="td-page-meta--view td-page-meta__view" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
  <a href="https://github.com/raphideb/raphideb.github.io/edit/main/content/oracle/ashtop.md" class="td-page-meta--edit td-page-meta__edit" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  <a href="https://github.com/raphideb/raphideb.github.io/new/main/content/oracle?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" class="td-page-meta--child td-page-meta__child" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
  <a href="https://github.com/raphideb/raphideb.github.io/issues/new?title=ashtop" class="td-page-meta--issue td-page-meta__issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
  
</div>

            <div class="td-toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#ashtop---the-swiss-army-knife-for-ash">ashtop - the Swiss Army Knife for ASH</a></li>
    <li><a href="#syntax">Syntax</a>
      <ul>
        <li><a href="#structure-of-ashtop">Structure of ashtop</a></li>
        <li><a href="#time-specifications">Time specifications</a></li>
        <li><a href="#derived-columns">Derived columns</a></li>
        <li><a href="#empty-sql_id">Empty SQL_ID</a></li>
        <li><a href="#formatting">Formatting</a></li>
        <li><a href="#customizing-ashtopsql">Customizing ashtop.sql</a></li>
      </ul>
    </li>
    <li><a href="#using-ashtop">Using ashtop</a></li>
    <li><a href="#example-queries">Example queries</a>
      <ul>
        <li><a href="#top-events-of-the-last-hour">Top events of the last hour</a></li>
        <li><a href="#top-waits-of-the-last-5-minutes">Top waits of the last 5 minutes</a></li>
        <li><a href="#sessions-with-highest-cpu-usage">Sessions with highest CPU usage</a></li>
        <li><a href="#sessions-with-the-highest-io-waits">Sessions with the highest I/O waits</a></li>
        <li><a href="#what-was-the-application-doing">What was the application doing</a></li>
        <li><a href="#what-was-a-specific-session-doing">What was a specific session doing</a></li>
        <li><a href="#which-waits-on-which-objects">Which waits on which objects</a></li>
        <li><a href="#which-sql-statement-read-the-longest-from-what">Which SQL statement read the longest from what</a></li>
        <li><a href="#what-caused-the-most-log-file-syncs">What caused the most log file syncs</a></li>
        <li><a href="#are-top-sessions-blocked-by-another-session">Are top sessions blocked by another session</a></li>
        <li><a href="#top-blocked-sessions">Top blocked sessions</a></li>
        <li><a href="#on-which-objects-blocked-sessions-each-other">On which objects blocked sessions each other</a></li>
        <li><a href="#highest-pga-usage">Highest PGA usage</a></li>
      </ul>
    </li>
    <li><a href="#sql-plan-statistics">SQL plan statistics</a>
      <ul>
        <li><a href="#with-ashtop">With ashtop</a></li>
        <li><a href="#with-asqlmon">With asqlmon</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
      </div>
    
            

          </aside>
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="/oracle/">Oracle</a></li>
  <li class="breadcrumb-item active" aria-current="page">
    ashtop</li>
  </ol>
</nav>
<div class="td-content">
	<h1>ashtop</h1>
	<div class="lead">Usage and examples for Tanel Poder&rsquo;s ashtop, the fastest way to query ASH</div>
	<header class="article-meta">
		
<p class="reading-time"><i class="fa-solid fa-clock" aria-hidden="true"></i>&nbsp; 10 minute read &nbsp;</p>
</header>
	<h2 id="ashtop---the-swiss-army-knife-for-ash">ashtop - the Swiss Army Knife for ASH</h2>
<img class="floatimg" src="/oracle/ashtop.jpg" alt="ashtop" width="30%" height="30%"/>
<p>
Tanel Poder's script "ashtop.sql" greatly simplifies querying ASH and is essentially a fully parameterizable "grep" for ASH. The script comes in two variants:  
<p>ashtop.sql  → for querying ASH: <code>gv$active_session_history</code><br>
dashtop.sql → for querying DASH: <code>dba_hist_active_sess_history</code></p>
<p>Both scripts are in the &ldquo;ash&rdquo; directory of Tanel&rsquo;s github: <a href="https://github.com/tanelpoder/tpt-oracle">https://github.com/tanelpoder/tpt-oracle</a></p>
<p><strong>Pro tip:</strong> do yourself a favour and download the whole repository. There are many, many more very useful scripts for all kinds of DBA tasks.</p>
<p>There&rsquo;s also a very good video by Tanel on YouTube that explains how ashtop works:<br>
<a href="https://www.youtube.com/watch?v=D7bg1Am7Y9s">https://www.youtube.com/watch?v=D7bg1Am7Y9s</a></p>
<p>To use ashtop efficiently, it is necessary to know the structure of ASH and how it works. If you haven&rsquo;t read it yet, check out this post: <a href="/oracle/ash">Active Session History</a>. Note: whenever I mention &ldquo;ASH&rdquo; or &ldquo;ashtop&rdquo;, the same is true for &ldquo;DASH&rdquo; and &ldquo;dashtop&rdquo;.</p>
</p>
<div style="clear: both;"></div>
<h2 id="syntax">Syntax</h2>
<p>The basic syntax is very simple:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">@ashtop &lt;GROUP BY&gt; &lt;FILTER&gt; &lt;BEGIN_TIME&gt; &lt;END_TIME&gt;<span class="p">;</span>
</span></span></code></pre></div><ul>
<li><strong>GROUP BY</strong>: What to group by, e.g., session_id, sql_id, event</li>
<li><strong>FILTER</strong>: What to filter by, e.g., <code>session_type='FOREGROUND'</code> or <code>event like 'gc%'</code></li>
<li><strong>BEGIN_TIME</strong>: From which point in time, e.g., <code>sysdate-1/24</code></li>
<li><strong>END_TIME</strong>: Until which point in time, e.g., <code>sysdate</code></li>
</ul>
<h3 id="structure-of-ashtop">Structure of ashtop</h3>
<p>This is the basic structure of the script, quite similar to the basic script covered in the post about ASH. However, the complete script has over 130 lines ;)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&amp;</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">&#34;TotalSeconds&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">gv$active_session_history</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">dba_users</span><span class="w"> </span><span class="n">u</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">dba_objects</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">current_obj</span><span class="o">#</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">object_id</span><span class="p">(</span><span class="o">+</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">sample_time</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">3</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&amp;</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="s2">&#34;TotalSeconds&#34;</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></div><h3 id="time-specifications">Time specifications</h3>
<p>BEGIN and END_TIME can be passed to the script in various ways, mixed forms are also possible:</p>
<ul>
<li>Relative to sysdate:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="n">sql_id</span><span class="w"> </span><span class="n">session_type</span><span class="o">=</span><span class="s1">&#39;FOREGROUND&#39;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="o">/</span><span class="mi">12</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>ANSI syntax 1:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="n">sql_id</span><span class="w"> </span><span class="n">session_type</span><span class="o">=</span><span class="s1">&#39;FOREGROUND&#39;</span><span class="w"> </span><span class="nb">DATE</span><span class="s1">&#39;2021-08-24&#39;</span><span class="w"> </span><span class="nb">DATE</span><span class="s1">&#39;2021-08-25&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>ANSI syntax 2:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="n">sql_id</span><span class="w"> </span><span class="n">session_type</span><span class="o">=</span><span class="s1">&#39;FOREGROUND&#39;</span><span class="w"> </span><span class="s2">&#34;TIMESTAMP&#39;2024-04-17 18:00:00&#39;&#34;</span><span class="w"> </span><span class="s2">&#34;TIMESTAMP&#39;2024-04-17 20:00:00&#39;&#34;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>to_date:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="n">sql_id</span><span class="w"> </span><span class="n">session_type</span><span class="o">=</span><span class="s1">&#39;FOREGROUND&#39;</span><span class="w"> </span><span class="s2">&#34;to_date(&#39;24-AUG-21 18:00&#39;, &#39;DD-MON-YY HH24:MI&#39;)&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>More info on using ANSI syntax in Tanel&rsquo;s scripts:<br>
<a href="https://tanelpoder.com/2012/12/29/a-tip-for-lazy-oracle-users-type-less-with-ansi-date-and-timestamp-sql-syntax/">https://tanelpoder.com/2012/12/29/a-tip-for-lazy-oracle-users-type-less-with-ansi-date-and-timestamp-sql-syntax/</a></p>
<h3 id="derived-columns">Derived columns</h3>
<p>The script includes various derived columns that do not exist like this in ASH.</p>
<h4 id="username-and-objt">username and objt</h4>
<p>Users and objects are only listed as IDs in ASH; if you want the names, you have to join dba_user and dba_objects. Ashtop simplifies this with the columns <code>username</code> and <code>objt</code>. These columns can be used as GROUP BY and as filters.</p>
<p>For example, to show the top 15 users accessing an object named &ldquo;TABLE_NAME&rdquo;:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="s2">&#34;objt=&#39;TABLE_NAME&#39;&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Or the top objects accessed by the user &ldquo;USER&rdquo;:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">objt</span><span class="w"> </span><span class="s2">&#34;username=&#39;USER&#39;&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>The script always returns the top 15 rows that match the specified arguments. Usually, that&rsquo;s enough, but it also means you don&rsquo;t see the rest of the waits. If you can&rsquo;t find the cause of a problem with ashtop, you should analyze the ASH with the basic script described in the post about ASH.</p>
<h4 id="event2">event2</h4>
<p>When a session is on the CPU, the EVENT column is NULL. To see that it was really on the CPU, you would have to output SESSION_STATE as well:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">sql_id</span><span class="p">,</span><span class="n">session_state</span><span class="p">,</span><span class="n">event</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Example output:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Seconds</th>
          <th style="text-align: left">AAS</th>
          <th style="text-align: left">%This</th>
          <th style="text-align: left">SQL_ID</th>
          <th style="text-align: left">SESSION</th>
          <th style="text-align: left">EVENT</th>
          <th style="text-align: left">FIRST_SEEN</th>
          <th style="text-align: left">LAST_SEEN</th>
          <th style="text-align: left">Execs Seen</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">2343</td>
          <td style="text-align: left">.7</td>
          <td style="text-align: left">5%</td>
          <td style="text-align: left">c0syzmwpwp3mw</td>
          <td style="text-align: left">ON CPU</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">2021-09-10 12:44:19</td>
          <td style="text-align: left">2021-09-10 13:44:16</td>
          <td style="text-align: left">1449</td>
      </tr>
      <tr>
          <td style="text-align: left">1524</td>
          <td style="text-align: left">.4</td>
          <td style="text-align: left">3%</td>
          <td style="text-align: left">fj40waf596jva</td>
          <td style="text-align: left">ON CPU</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">2021-09-10 12:44:21</td>
          <td style="text-align: left">2021-09-10 13:44:16</td>
          <td style="text-align: left">7</td>
      </tr>
  </tbody>
</table>
<p>To avoid having to always specify session_state, you can simply use the column &ldquo;event2&rdquo;:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">sql_id</span><span class="p">,</span><span class="n">event2</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Example output:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Seconds</th>
          <th style="text-align: left">AAS</th>
          <th style="text-align: left">%This</th>
          <th style="text-align: left">SQL_ID</th>
          <th style="text-align: left">EVENT2</th>
          <th style="text-align: left">FIRST_SEEN</th>
          <th style="text-align: left">LAST_SEEN</th>
          <th style="text-align: left">Execs Seen</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">2343</td>
          <td style="text-align: left">.7</td>
          <td style="text-align: left">5%</td>
          <td style="text-align: left">c0syzmwpwp3mw</td>
          <td style="text-align: left">ON CPU</td>
          <td style="text-align: left">2021-09-10 12:44:32</td>
          <td style="text-align: left">2021-09-10 13:44:29</td>
          <td style="text-align: left">1449</td>
      </tr>
      <tr>
          <td style="text-align: left">1528</td>
          <td style="text-align: left">.4</td>
          <td style="text-align: left">3%</td>
          <td style="text-align: left">fj40waf596jva</td>
          <td style="text-align: left">ON CPU</td>
          <td style="text-align: left">2021-09-10 12:44:30</td>
          <td style="text-align: left">2021-09-10 13:44:29</td>
          <td style="text-align: left">7</td>
      </tr>
  </tbody>
</table>
<p>A value of 1 for AAS and &ldquo;ON CPU&rdquo; EVENT2 means that approximately one CPU core was busy with this execution. The value scales; AAS of 5 means 5 cores were busy.</p>
<h4 id="time_model_name">time_model_name</h4>
<p>ASH offers many columns that show which step of execution the query was currently in, e.g. Hard Parse or SQL Execution:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Column</th>
          <th style="text-align: left">Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">IN_CONNECTION_MGMT</td>
          <td style="text-align: left">Was the session doing connection management at sampling? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_PARSE</td>
          <td style="text-align: left">Was the session parsing at sampling? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_HARD_PARSE</td>
          <td style="text-align: left">Was the session hard parsing at sampling? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_SQL_EXECUTION</td>
          <td style="text-align: left">Was the session executing SQL at sampling? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_PLSQL_EXECUTION</td>
          <td style="text-align: left">Was the session executing PL/SQL at sampling? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_PLSQL_RPC</td>
          <td style="text-align: left">Was the session executing inbound PL/SQL RPC at sampling? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_PLSQL_COMPILATION</td>
          <td style="text-align: left">Was the session compiling PL/SQL at sampling? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_JAVA_EXECUTION</td>
          <td style="text-align: left">Was the session executing Java at sampling? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_BIND</td>
          <td style="text-align: left">Was the session doing bind operations at sampling? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_CURSOR_CLOSE</td>
          <td style="text-align: left">Was the session closing a cursor at sampling? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_SEQUENCE_LOAD</td>
          <td style="text-align: left">Was the session loading in sequence at sampling? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_INMEMORY_QUERY</td>
          <td style="text-align: left">Was the session querying In-Memory Column Store? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_INMEMORY_POPULATE</td>
          <td style="text-align: left">Was the session populating IM column store? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_INMEMORY_PREPOPULATE</td>
          <td style="text-align: left">Was the session prepopulating IM column store? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_INMEMORY_REPOPULATE</td>
          <td style="text-align: left">Was the session repopulating IM column store? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_INMEMORY_TREPOPULATE</td>
          <td style="text-align: left">Was the session trickle repopulating IM column store? (Y/N)</td>
      </tr>
      <tr>
          <td style="text-align: left">IN_TABLESPACE_ENCRYPTION</td>
          <td style="text-align: left">Was encryption/decryption of a tablespace occurring? (Y/N)</td>
      </tr>
  </tbody>
</table>
<p>To avoid passing all these columns as arguments to ashtop, you can use the derived column &ldquo;time_model_name&rdquo;. It is based on the ASH &ldquo;Time_Model&rdquo; bitfield and maps the value to a descriptive text:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">sql_id</span><span class="p">,</span><span class="n">time_model_name</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Example output:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Seconds</th>
          <th style="text-align: left">AAS</th>
          <th style="text-align: left">%This</th>
          <th style="text-align: left">SQL_ID</th>
          <th style="text-align: left">TIME_MODEL_NAME</th>
          <th style="text-align: left">FIRST_SEEN</th>
          <th style="text-align: left">LAST_SEEN</th>
          <th style="text-align: left">Execs Seen</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">737</td>
          <td style="text-align: left">.2</td>
          <td style="text-align: left">4%</td>
          <td style="text-align: left">g9u23ytkurdwz</td>
          <td style="text-align: left">SQL_EXECUTION</td>
          <td style="text-align: left">2021-09-13 12:18:58</td>
          <td style="text-align: left">2021-09-13 13:16:23</td>
          <td style="text-align: left">737</td>
      </tr>
      <tr>
          <td style="text-align: left">549</td>
          <td style="text-align: left">.2</td>
          <td style="text-align: left">3%</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">CONNECTION_MGMT</td>
          <td style="text-align: left">2021-09-13 12:19:03</td>
          <td style="text-align: left">2021-09-13 13:18:27</td>
          <td style="text-align: left">1</td>
      </tr>
      <tr>
          <td style="text-align: left">480</td>
          <td style="text-align: left">.1</td>
          <td style="text-align: left">3%</td>
          <td style="text-align: left">1pyct56psc65z</td>
          <td style="text-align: left">SQL_EXECUTION</td>
          <td style="text-align: left">2021-09-13 12:19:03</td>
          <td style="text-align: left">2021-09-13 13:18:51</td>
          <td style="text-align: left">480</td>
      </tr>
      <tr>
          <td style="text-align: left">478</td>
          <td style="text-align: left">.1</td>
          <td style="text-align: left">3%</td>
          <td style="text-align: left">6u8vh1hymdfh3</td>
          <td style="text-align: left">SQL_EXECUTION</td>
          <td style="text-align: left">2021-09-13 12:18:54</td>
          <td style="text-align: left">2021-09-13 13:18:52</td>
          <td style="text-align: left">478</td>
      </tr>
  </tbody>
</table>
<h5 id="meaning-of-some-of-the-time_model_name">Meaning of some of the time_model_name</h5>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Time_Model_Name</th>
          <th style="text-align: left">Meaning</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">SQL_EXECUTION</td>
          <td style="text-align: left">Statement is being executed</td>
      </tr>
      <tr>
          <td style="text-align: left">PARSE</td>
          <td style="text-align: left">Soft parse</td>
      </tr>
      <tr>
          <td style="text-align: left">HARD_PARSE</td>
          <td style="text-align: left">Hard parse</td>
      </tr>
      <tr>
          <td style="text-align: left">PARSE HARD_PARSE</td>
          <td style="text-align: left">Soft parse attempted, ended in hard parse</td>
      </tr>
      <tr>
          <td style="text-align: left">CONNECTION_MGMT</td>
          <td style="text-align: left">Login/Logouts</td>
      </tr>
      <tr>
          <td style="text-align: left">BIND</td>
          <td style="text-align: left">Binds are being filled</td>
      </tr>
      <tr>
          <td style="text-align: left">(Empty line)</td>
          <td style="text-align: left">Step not represented in ASH</td>
      </tr>
  </tbody>
</table>
<h3 id="empty-sql_id">Empty SQL_ID</h3>
<p>Sometimes ashtop shows no SQL_ID for a session, either because the session belongs to a background process (in that case, the user is SYS and SESSION_TYPE is BACKGROUND) or because the session is mainly waiting for commits.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">sql_id</span><span class="p">,</span><span class="n">event2</span><span class="p">,</span><span class="n">username</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Example output:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Seconds</th>
          <th style="text-align: left">AAS</th>
          <th style="text-align: left">%This</th>
          <th style="text-align: left">SQL_ID</th>
          <th style="text-align: left">EVENT2</th>
          <th style="text-align: left">USERNAME</th>
          <th style="text-align: left">SESSION_TYPE</th>
          <th style="text-align: left">FIRST_SEEN</th>
          <th style="text-align: left">LAST_SEEN</th>
          <th style="text-align: left">Execs Seen</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">3068</td>
          <td style="text-align: left">.9</td>
          <td style="text-align: left">57%</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">log file sync</td>
          <td style="text-align: left">RAPHI_APPL</td>
          <td style="text-align: left">FOREGROUND</td>
          <td style="text-align: left">2021-09-13 11:50:28</td>
          <td style="text-align: left">2021-09-13 12:50:23</td>
          <td style="text-align: left">1</td>
      </tr>
      <tr>
          <td style="text-align: left">809</td>
          <td style="text-align: left">.2</td>
          <td style="text-align: left">15%</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">ON CPU</td>
          <td style="text-align: left">RAPHI_APPL</td>
          <td style="text-align: left">FOREGROUND</td>
          <td style="text-align: left">2021-09-13 11:50:26</td>
          <td style="text-align: left">2021-09-13 12:50:21</td>
          <td style="text-align: left">1</td>
      </tr>
      <tr>
          <td style="text-align: left">100</td>
          <td style="text-align: left">.0</td>
          <td style="text-align: left">2%</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">ON CPU</td>
          <td style="text-align: left">SYS</td>
          <td style="text-align: left">BACKGROUND</td>
          <td style="text-align: left">2021-09-13 11:51:19</td>
          <td style="text-align: left">2021-09-13 12:50:03</td>
          <td style="text-align: left">1</td>
      </tr>
  </tbody>
</table>
<p>If you want to see what the user session is actually doing even though no SQL_ID is listed, you can search for &ldquo;Top_Level_Call_Name&rdquo;:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">sql_id</span><span class="p">,</span><span class="n">top_level_call_name</span><span class="p">,</span><span class="n">event2</span><span class="w"> </span><span class="s2">&#34;sql_id is null and username=&#39;RAPHI_APPL&#39;&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Example output:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Seconds</th>
          <th style="text-align: left">AAS</th>
          <th style="text-align: left">%This</th>
          <th style="text-align: left">SQL_ID</th>
          <th style="text-align: left">TOP_LEVEL_CALL_NAME</th>
          <th style="text-align: left">EVENT2</th>
          <th style="text-align: left">FIRST_SEEN</th>
          <th style="text-align: left">LAST_SEEN</th>
          <th style="text-align: left">Execs Seen</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">2879</td>
          <td style="text-align: left">.8</td>
          <td style="text-align: left">65%</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">COMMIT</td>
          <td style="text-align: left">log file sync</td>
          <td style="text-align: left">2021-09-13 11:54:40</td>
          <td style="text-align: left">2021-09-13 12:54:38</td>
          <td style="text-align: left">1</td>
      </tr>
      <tr>
          <td style="text-align: left">195</td>
          <td style="text-align: left">.1</td>
          <td style="text-align: left">4%</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">COMMIT</td>
          <td style="text-align: left">ON CPU</td>
          <td style="text-align: left">2021-09-13 11:55:09</td>
          <td style="text-align: left">2021-09-13 12:54:13</td>
          <td style="text-align: left">1</td>
      </tr>
      <tr>
          <td style="text-align: left">183</td>
          <td style="text-align: left">.1</td>
          <td style="text-align: left">4%</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">V8 Bundled Exec</td>
          <td style="text-align: left">ON CPU</td>
          <td style="text-align: left">2021-09-13 11:55:56</td>
          <td style="text-align: left">2021-09-13 12:54:05</td>
          <td style="text-align: left">1</td>
      </tr>
  </tbody>
</table>
<h3 id="formatting">Formatting</h3>
<p>Tanel assumes you use his scripts in a terminal where you can scroll horizontally. If not, you should at least increase the linesize and maybe shorten a few columns:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">set</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="mi">400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">col</span><span class="w"> </span><span class="n">objt</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">a30</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">col</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">a30</span><span class="w">
</span></span></span></code></pre></div><h3 id="customizing-ashtopsql">Customizing ashtop.sql</h3>
<p>Sometimes it is necessary to customize ashtop.sql, for example to show more than the top 15 events or to sort by another criteria. It&rsquo;s best to create a copy of the original ashtop.sql before you customize it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cp /nas/smdb/scripts/sql/ash/ashtop.sql <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">vi ashtop.sql
</span></span></code></pre></div><p>Change the order by and the number of rows returned:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="c1">-- TotalSeconds DESC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">       </span><span class="n">time_waited</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ROWNUM &lt;= 15
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">ROWNUM</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">30</span><span class="w">
</span></span></span></code></pre></div><h4 id="working-with-a-copy-of-the-ash">Working with a copy of the ASH</h4>
<p>If a copy of the ASH has been created with CTAS for backup, the following line needs to be changed to the saved ASH:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cp /nas/smdb/scripts/sql/ash/ashtop.sql <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">vi ashtop.sql
</span></span><span class="line"><span class="cl">-- FROM gv<span class="nv">$active_session_history</span> a<span class="o">)</span> a
</span></span><span class="line"><span class="cl">   FROM ash_save220901 a<span class="o">)</span> a
</span></span></code></pre></div><h2 id="using-ashtop">Using ashtop</h2>
<p>A simple query looks like this, the structure is always the same:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">sys</span><span class="o">@</span><span class="n">CIS_1</span><span class="o">/</span><span class="n">T1</span><span class="o">&gt;</span><span class="w"> </span><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="n">sql_id</span><span class="w"> </span><span class="n">session_type</span><span class="o">=</span><span class="s1">&#39;FOREGROUND&#39;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Example output:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Seconds</th>
          <th style="text-align: left">AAS</th>
          <th style="text-align: left">%This</th>
          <th style="text-align: left">USERNAME</th>
          <th style="text-align: left">SQL_ID</th>
          <th style="text-align: left">FIRST_SEEN</th>
          <th style="text-align: left">LAST_SEEN</th>
          <th style="text-align: left">Execs Seen</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">1184</td>
          <td style="text-align: left">.2</td>
          <td style="text-align: left">9%</td>
          <td style="text-align: left">RAPHI_USER</td>
          <td style="text-align: left">37hs5hm167vhy</td>
          <td style="text-align: left">2019-11-26 12:35:38</td>
          <td style="text-align: left">2019-11-26 12:40:24</td>
          <td style="text-align: left">2</td>
      </tr>
      <tr>
          <td style="text-align: left">583</td>
          <td style="text-align: left">.1</td>
          <td style="text-align: left">4%</td>
          <td style="text-align: left">RAPHI_APPL</td>
          <td style="text-align: left">bxj6rfn7du7c8</td>
          <td style="text-align: left">2019-11-26 11:57:30</td>
          <td style="text-align: left">2019-11-26 12:54:25</td>
          <td style="text-align: left">2</td>
      </tr>
      <tr>
          <td style="text-align: left">378</td>
          <td style="text-align: left">.1</td>
          <td style="text-align: left">3%</td>
          <td style="text-align: left">RAPHI_APPL</td>
          <td style="text-align: left">9jwmpa0zs1czv</td>
          <td style="text-align: left">2019-11-26 12:02:15</td>
          <td style="text-align: left">2019-11-26 12:03:23</td>
          <td style="text-align: left">1</td>
      </tr>
      <tr>
          <td style="text-align: left">&hellip;</td>
          <td style="text-align: left">&hellip;</td>
          <td style="text-align: left">&hellip;</td>
          <td style="text-align: left">&hellip;</td>
          <td style="text-align: left">&hellip;</td>
          <td style="text-align: left">&hellip;</td>
          <td style="text-align: left">&hellip;</td>
          <td style="text-align: left">&hellip;</td>
      </tr>
  </tbody>
</table>
<ul>
<li>First, these three columns are listed:
<ul>
<li><strong>Total Seconds</strong>: How many seconds all executions of the query are listed in ASH for the specified period</li>
<li><strong>AAS</strong>: Average Active Sessions spent per second with the wait event in the specified period</li>
<li><strong>%This</strong>: Ratio of the specified period to seconds all sessions spent with this event</li>
</ul>
</li>
<li>Then, the columns passed as the first argument (GROUP BY) are shown:
<ul>
<li>USERNAME</li>
<li>SQL_ID</li>
</ul>
</li>
<li>Lastly, some timing information
<ul>
<li><strong>FIRST_SEEN</strong>: First execution in the specified period</li>
<li><strong>LAST_SEEN</strong>: Last execution in the specified period</li>
<li><strong>Distinct Execs Seen</strong>: Number of different executions in the specified period</li>
</ul>
</li>
</ul>
<h2 id="example-queries">Example queries</h2>
<p>There are countless ways to query ASH with ashtop, here is a selection:</p>
<h3 id="top-events-of-the-last-hour">Top events of the last hour</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">event2</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="top-waits-of-the-last-5-minutes">Top waits of the last 5 minutes</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">event2</span><span class="w"> </span><span class="s2">&#34;event2 not like &#39;ON CPU&#39;&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="o">/</span><span class="mi">12</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="sessions-with-highest-cpu-usage">Sessions with highest CPU usage</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">session_id</span><span class="p">,</span><span class="n">sql_id</span><span class="w"> </span><span class="s2">&#34;event2=&#39;ON CPU&#39;&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="sessions-with-the-highest-io-waits">Sessions with the highest I/O waits</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">session_id</span><span class="p">,</span><span class="n">sql_id</span><span class="p">,</span><span class="n">event2</span><span class="w"> </span><span class="s2">&#34;wait_class = &#39;User I/O&#39;&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="what-was-the-application-doing">What was the application doing</h3>
<p>Assuminge all application users begin with RAPHI_</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">sql_id</span><span class="p">,</span><span class="n">sql_opname</span><span class="p">,</span><span class="n">event2</span><span class="w"> </span><span class="s2">&#34;username like &#39;RAPHI%&#39;&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="what-was-a-specific-session-doing">What was a specific session doing</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">sql_id</span><span class="p">,</span><span class="n">sql_opname</span><span class="p">,</span><span class="n">event2</span><span class="w"> </span><span class="s2">&#34;session_id=1667 and session_serial#=45570&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="which-waits-on-which-objects">Which waits on which objects</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">objt</span><span class="p">,</span><span class="n">event2</span><span class="p">,</span><span class="n">sql_id</span><span class="w"> </span><span class="s2">&#34;event2 NOT LIKE &#39;ON CPU&#39;&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="which-sql-statement-read-the-longest-from-what">Which SQL statement read the longest from what</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">objt</span><span class="p">,</span><span class="n">sql_id</span><span class="w"> </span><span class="s2">&#34;event like &#39;%read%&#39;&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="what-caused-the-most-log-file-syncs">What caused the most log file syncs</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">sql_opname</span><span class="p">,</span><span class="n">top_level_call_name</span><span class="w"> </span><span class="s2">&#34;event=&#39;log file sync&#39;&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="are-top-sessions-blocked-by-another-session">Are top sessions blocked by another session</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">session_id</span><span class="p">,</span><span class="n">sql_id</span><span class="p">,</span><span class="n">event2</span><span class="p">,</span><span class="n">blocking_session</span><span class="w"> </span><span class="n">session_type</span><span class="o">=</span><span class="s1">&#39;FOREGROUND&#39;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="top-blocked-sessions">Top blocked sessions</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">session_id</span><span class="p">,</span><span class="n">sql_id</span><span class="p">,</span><span class="n">event2</span><span class="p">,</span><span class="n">blocking_session</span><span class="w"> </span><span class="s2">&#34;event2 NOT LIKE &#39;ON CPU&#39; and blocking_session is not null&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="on-which-objects-blocked-sessions-each-other">On which objects blocked sessions each other</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="n">sql_id</span><span class="p">,</span><span class="n">session_id</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">blocking_session</span><span class="p">,</span><span class="n">objt</span><span class="w"> </span><span class="s2">&#34;event like &#39;enq: TX%&#39;&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="highest-pga-usage">Highest PGA usage</h3>
<p>Change the ORDER BY in a copy of ashtop.sql</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">vi</span><span class="w"> </span><span class="n">ashtop</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- TotalSeconds DESC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w"> </span><span class="n">PGA_ALLOCATED</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span></code></pre></div><p>Then:</p>
<pre tabindex="0"><code>@ashtop pga_allocated,sql_id &#34;session_type=&#39;FOREGROUND&#39;&#34; sysdate-1/24 sysdate;
</code></pre><h2 id="sql-plan-statistics">SQL plan statistics</h2>
<p>With ASH it&rsquo;s possible to find out in which step of the execution plan the query spent the most time. It can be done with ashtop or with another script from Tanel, asqlmon.</p>
<h3 id="with-ashtop">With ashtop</h3>
<p>Unless specified with a hint, SQL Monitor only records statements that ran at least for 5 seconds. If you want to know which part of the execution plan consumed the most time for a query not captured by SQL Monitor, you have to use ASH. The following columns are available:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Column</th>
          <th style="text-align: left">Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">SQL_FULL_PLAN_HASH_VALUE</td>
          <td style="text-align: left">Numerical representation of the complete SQL plan for the cursor</td>
      </tr>
      <tr>
          <td style="text-align: left">SQL_PLAN_HASH_VALUE</td>
          <td style="text-align: left">Numeric representation of the SQL plan for the cursor</td>
      </tr>
      <tr>
          <td style="text-align: left">SQL_PLAN_LINE_ID</td>
          <td style="text-align: left">SQL plan line ID</td>
      </tr>
      <tr>
          <td style="text-align: left">SQL_PLAN_OPERATION</td>
          <td style="text-align: left">Plan operation name</td>
      </tr>
      <tr>
          <td style="text-align: left">SQL_PLAN_OPTIONS</td>
          <td style="text-align: left">Plan operation options</td>
      </tr>
  </tbody>
</table>
<p>With the SQL_ID of the statement, you can see where most of the time was spent:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">ashtop</span><span class="w"> </span><span class="n">sql_plan_line_id</span><span class="p">,</span><span class="n">sql_plan_operation</span><span class="p">,</span><span class="n">sql_plan_options</span><span class="w"> </span><span class="s2">&#34;sql_id=&#39;28w88hbtt3766&#39;&#34;</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Example output:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Seconds</th>
          <th style="text-align: left">AAS</th>
          <th style="text-align: left">%This</th>
          <th style="text-align: left">SQL_PLAN_LINE_ID</th>
          <th style="text-align: left">SQL_PLAN_OPERATION</th>
          <th style="text-align: left">SQL_PLAN_OPTIONS</th>
          <th style="text-align: left">FIRST_SEEN</th>
          <th style="text-align: left">LAST_SEEN</th>
          <th style="text-align: left">Execs Seen</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">387</td>
          <td style="text-align: left">.1</td>
          <td style="text-align: left">58%</td>
          <td style="text-align: left">8</td>
          <td style="text-align: left">TABLE ACCESS</td>
          <td style="text-align: left">BY LOCAL INDEX ROWID BATCHED</td>
          <td style="text-align: left">2021-09-13 10:38:46</td>
          <td style="text-align: left">2021-09-13 11:11:32</td>
          <td style="text-align: left">159</td>
      </tr>
      <tr>
          <td style="text-align: left">136</td>
          <td style="text-align: left">.0</td>
          <td style="text-align: left">20%</td>
          <td style="text-align: left">9</td>
          <td style="text-align: left">INDEX</td>
          <td style="text-align: left">RANGE SCAN</td>
          <td style="text-align: left">2021-09-13 10:38:46</td>
          <td style="text-align: left">2021-09-13 11:11:31</td>
          <td style="text-align: left">114</td>
      </tr>
      <tr>
          <td style="text-align: left">108</td>
          <td style="text-align: left">.0</td>
          <td style="text-align: left">16%</td>
          <td style="text-align: left">15</td>
          <td style="text-align: left">TABLE ACCESS</td>
          <td style="text-align: left">BY LOCAL INDEX ROWID BATCHED</td>
          <td style="text-align: left">2021-09-13 10:38:50</td>
          <td style="text-align: left">2021-09-13 11:11:33</td>
          <td style="text-align: left">108</td>
      </tr>
      <tr>
          <td style="text-align: left">27</td>
          <td style="text-align: left">.0</td>
          <td style="text-align: left">4%</td>
          <td style="text-align: left">16</td>
          <td style="text-align: left">INDEX</td>
          <td style="text-align: left">SKIP SCAN</td>
          <td style="text-align: left">2021-09-13 10:38:50</td>
          <td style="text-align: left">2021-09-13 11:11:32</td>
          <td style="text-align: left">27</td>
      </tr>
      <tr>
          <td style="text-align: left">4</td>
          <td style="text-align: left">.0</td>
          <td style="text-align: left">1%</td>
          <td style="text-align: left">3</td>
          <td style="text-align: left">SORT</td>
          <td style="text-align: left">UNIQUE</td>
          <td style="text-align: left">2021-09-13 10:38:49</td>
          <td style="text-align: left">2021-09-13 11:11:27</td>
          <td style="text-align: left">4</td>
      </tr>
      <tr>
          <td style="text-align: left">3</td>
          <td style="text-align: left">.0</td>
          <td style="text-align: left">0%</td>
          <td style="text-align: left">11</td>
          <td style="text-align: left">TABLE ACCESS</td>
          <td style="text-align: left">BY GLOBAL INDEX ROWID BATCHED</td>
          <td style="text-align: left">2021-09-13 10:38:47</td>
          <td style="text-align: left">2021-09-13 10:38:53</td>
          <td style="text-align: left">3</td>
      </tr>
      <tr>
          <td style="text-align: left">2</td>
          <td style="text-align: left">.0</td>
          <td style="text-align: left">0%</td>
          <td style="text-align: left">12</td>
          <td style="text-align: left">INDEX</td>
          <td style="text-align: left">RANGE SCAN</td>
          <td style="text-align: left">2021-09-13 10:38:48</td>
          <td style="text-align: left">2021-09-13 11:11:24</td>
          <td style="text-align: left">2</td>
      </tr>
      <tr>
          <td style="text-align: left">1</td>
          <td style="text-align: left">.0</td>
          <td style="text-align: left">0%</td>
          <td style="text-align: left">5</td>
          <td style="text-align: left">FILTER</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">2021-09-13 10:38:46</td>
          <td style="text-align: left">2021-09-13 10:38:46</td>
          <td style="text-align: left">1</td>
      </tr>
  </tbody>
</table>
<p>This means that the query spent 58% of its time reading rows from a table, 20% searching the rows in the index, etc.</p>
<h3 id="with-asqlmon">With asqlmon</h3>
<p>Also in the &ldquo;ash&rdquo; directory of Tanel&rsquo;s github repo is the script asqlmon.sql:<br>
<a href="https://github.com/tanelpoder/tpt-oracle">https://github.com/tanelpoder/tpt-oracle</a></p>
<p>The script simplifies querying plan statistics and provides even more information.</p>
<ul>
<li>First argument: sql_id</li>
<li>Second argument: Plan Hash Value (or % for all plans)</li>
<li>Third argument: Start time</li>
<li>Fourth argument: End time</li>
</ul>
<p>Call for the same query as in the ashtop example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">@</span><span class="n">asqlmon</span><span class="w"> </span><span class="mi">28</span><span class="n">w88hbtt3766</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">sysdate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">sysdate</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Output:
<img src="/oracle/asqlmon.jpg" alt="asqlmon" width="100%" height="100%"/></p>
<h2 id="conclusion">Conclusion</h2>
<p>Ashtop is a true time saver when it comes to working with ASH. It is much more flexible than &ldquo;Top Activity/ASH Analytics&rdquo; in Oracle&rsquo;s Enterprise Manager and provides some very handy shortcuts which have to be programmed when using self-made scripts, like the time_model_name column. Other useful scripts from Tanel that go hand-in-hand with ashtop:</p>
<ul>
<li>awr_sqlstats_per_exec       -&gt; discover plan changes of a query</li>
<li>(d)ash_wait_chains          -&gt; follow blocking sessions</li>
<li>(d)aslqmon                  -&gt; execution plan statistics, as described above</li>
<li>nonshared                   -&gt; show reasons why cursors were not shared</li>
<li>help.sql                    -&gt; description for many of Tanel&rsquo;s scripts</li>
</ul>

	
<div class="text-muted pt-3 border-top">
  Last modified: July 9, 2025
</div>


</div>


          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        
      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        
      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.js"></script>
<script defer src="/js/click-to-copy.js" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>